{"version":3,"sources":["webpack:///./app/components/Notice.js","webpack:///./app/components/OutlineLogo.js","webpack:///./shared/utils/parseDocumentSlug.js","webpack:///./app/scenes/ErrorOffline.js","webpack:///./shared/utils/getTasks.js","webpack:///./app/components/Branding.js","webpack:///./app/scenes/Document/components/Container.js","webpack:///./app/hooks/useWindowScrollPosition.js","webpack:///./app/scenes/Document/components/Contents.js","webpack:///./app/components/ClickablePadding.js","webpack:///./app/components/DocumentViews.js","webpack:///./app/components/Popover.js","webpack:///./app/components/DocumentMetaWithViews.js","webpack:///./app/components/HoverPreviewDocument.js","webpack:///./app/components/HoverPreview.js","webpack:///./app/scenes/Document/components/Editor.js","webpack:///./app/components/Collaborators.js","webpack:///./app/scenes/Document/components/PublicBreadcrumb.js","webpack:///./app/scenes/Document/components/SharePopover.js","webpack:///./app/scenes/Document/components/ShareButton.js","webpack:///./app/menus/NewChildDocumentMenu.js","webpack:///./app/menus/TableOfContentsMenu.js","webpack:///./app/menus/TemplatesMenu.js","webpack:///./app/scenes/Document/components/Header.js","webpack:///./app/hooks/useMobile.js","webpack:///./app/scenes/Document/components/KeyboardShortcutsButton.js","webpack:///./app/scenes/Document/components/MarkAsViewed.js","webpack:///./app/scenes/Document/components/ReferenceListItem.js","webpack:///./app/scenes/Document/components/PublicReferences.js","webpack:///./app/scenes/Document/components/References.js","webpack:///./app/scenes/Document/components/Document.js","webpack:///./app/utils/emoji.js","webpack:///./app/scenes/Document/components/HideSidebar.js","webpack:///./app/scenes/Document/components/Loading.js","webpack:///./app/scenes/Document/components/SocketPresence.js","webpack:///./app/scenes/Document/components/DataLoader.js","webpack:///./app/scenes/Document/KeyedDocument.js"],"names":["Notice","styled","p","props","theme","sidebarBackground","sidebarText","OutlineLogo","size","fill","className","width","height","viewBox","xmlns","d","parseDocumentSlug","url","parsed","URL","pathname","err","replace","ErrorOffline","t","useTranslation","CenteredContent","PageTitle","title","Empty","CHECKBOX_REGEX","getTasks","text","matches","matchAll","total","length","completed","reduce","accumulator","match","Link","a","Branding","href","env","Container","Flex","supportsPassive","opts","Object","defineProperty","get","window","addEventListener","removeEventListener","e","getPosition","x","pageXOffset","y","pageYOffset","defaultOptions","throttle","Contents","headings","React","activeSlug","setActiveSlug","position","useWindowScrollPosition","options","assign","useState","setPosition","useEffect","handleScroll","passive","cancel","key","heading","element","document","getElementById","decodeURIComponent","id","getBoundingClientRect","top","last","Math","max","headingAdjustment","memo","level","Infinity","Wrapper","Heading","List","map","ListItem","active","divider","breakpoint","HelpText","primary","ClickablePadding","div","onClick","grow","observer","DocumentViews","isOpen","useStores","views","documentPresence","presence","presentIds","Array","from","values","userId","editingIds","filter","isEditing","documentViews","inDocument","sortedViews","view","includes","user","users","v","PaginatedList","items","renderItem","item","find","isPresent","subtitle","timeAgo","formatDistanceToNow","Date","parse","lastViewedAt","name","image","Avatar","src","avatarUrl","border","small","fadeAndScaleIn","menuBackground","menuShadow","menuBorder","Popover","children","rest","Meta","DocumentMeta","rtl","DocumentMetaWithViews","to","isDraft","useObserver","totalViewers","onlyYou","isDeleted","fetchPage","documentId","popover","usePopoverState","gutter","placement","modal","PopoverDisclosure","aria-label","tabIndex","visible","Content","h2","HoverPreviewDocument","documents","slug","prefetchDocument","prefetch","getByUrl","undefined","titleWithDefault","fallback","Editor","defaultValue","getSummary","disableEmbeds","readOnly","HoverPreviewInternal","node","onClose","event","isVisible","setVisible","timerClose","timerOpen","cardRef","startCloseTimer","stopOpenTimer","current","setTimeout","stopCloseTimer","clearTimeout","startOpenTimer","anchorBounds","left","min","innerWidth","leftOffset","Position","bottom","scrollY","aria-hidden","ref","content","Animate","Card","Margin","CardContent","Pointer","offset","fadeAndSlideDown","background","transparentize","fixed","depths","hoverPreview","inject","HoverPreview","isInternalUrl","DocumentEditor","focusAtStart","innerRef","focusAtEnd","insertParagraph","dispatch","state","tr","insert","schema","nodes","paragraph","create","handleTitleKeyDown","preventDefault","isModKey","onSave","done","shiftKey","publish","handleLinkActive","activeLinkEvent","handleLinkInactive","this","onChangeTitle","shareId","policies","can","abilities","emoji","parseTitle","startsWithEmojiAndSpace","startsWith","normalizedTitle","auto","column","Title","as","$startsWithEmojiAndSpace","$isStarred","isStarred","dir","star","unstar","StarButton","type","onChange","onKeyDown","placeholder","isTemplate","value","autoFocus","maxLength","MAX_TITLE_LENGTH","documentHistoryUrl","getComputedStyle","direction","onHoverLink","scrollTo","location","hash","target","observable","Star","Textarea","backgroundTransition","AnimatedStar","light","withTranslation","FacepileHiddenOnMobile","Facepile","Collaborators","currentUserId","collaborators","orderedData","collaboratorIds","isFetching","forEach","fetch","NudeButton","renderAvatar","isCurrentUser","profileOnClick","PublicBreadcrumb","sharedTree","pathToDocument","path","traveler","previousPath","childNode","newPath","slice","Breadcrumb","SwitchWrapper","InputLink","Input","SwitchLabel","SwitchText","SharePopover","share","sharedParent","onSubmit","shares","showToast","useToasts","isCopied","setIsCopied","timeout","canPublish","update","isPubliclyShared","published","handlePublishedChange","getByDocumentId","invariant","save","currentTarget","checked","message","handleChildDocumentsChange","includeChildDocuments","handleCopied","color","Trans","defaults","documentTitle","components","em","Switch","label","disabled","lastAccessedAt","addSuffix","labelHidden","CopyToClipboard","onCopy","Button","ShareButton","getByDocumentParents","Tooltip","tooltip","delay","icon","neutral","hide","NewChildDocumentMenu","menu","useMenuState","collections","collection","collectionId","collectionName","MenuButton","ContextMenu","Template","newDocumentUrl","parentDocumentId","TableOfContentsMenu","unstable_preventOverflow","unstable_fixed","unstable_flip","minHeading","i","push","iconColor","borderOnHover","TemplateItem","Author","TemplatesMenu","templates","templatesInCollection","otherTemplates","renderTemplate","template","MenuItem","updateFromTemplate","author","createdBy","disclosure","Separator","Status","Action","slate","TocWrapper","DocumentHeader","isPublishing","isRevision","isSaving","savingIsDisabled","publishingIsDisabled","auth","ui","isMobile","useMobile","useTheme","useMediaQuery","breakpoints","tablet","handleSave","handlePublish","isNew","isNewDocument","canShareDocument","team","sharing","canToggleEmbeds","documentEmbeds","canEdit","toc","tocVisible","shortcut","hideTableOfContents","showTableOfContents","editAction","noun","editDocumentUrl","Header","breadcrumb","actions","DocumentBreadcrumb","isArchived","Badge","metaDisplay","createChildDocument","templateId","DocumentMenu","showToggleEmbeds","showPrint","KeyboardShortcutsButton","useBoolean","keyboardShortcutsOpen","handleOpenKeyboardShortcuts","handleCloseKeyboardShortcuts","Guide","onRequestClose","KeyboardShortcuts","MarkAsViewed","viewTimeout","updateLastViewed","DocumentLink","listItemHoverBackground","h3","StyledDocumentIcon","DocumentIcon","textSecondary","Emoji","span","ReferenceListItem","showCollection","anchor","RegExp","updatedBy","PublicReferences","result","findChildren","Subheading","References","fetchBacklinks","backlinks","getBacklinedDocuments","getDocumentChildren","showBacklinks","showNestedDocuments","isBacklinksTab","Fade","Tabs","Tab","isActive","backlinkedDocument","urlId","withRouter","DocumentScene","keydown","meta","getEditorText","trim","autosave","tasks","lastRevision","savedDocument","isDirty","revision","history","setActiveDocument","toasts","updateIsDirty","editorText","titleChanged","bodyChanged","isEmpty","updateIsDirtyDebounced","onImageUploadStart","isUploading","onImageUploadStop","goBack","prevProps","userName","action","documentUrl","injectTemplate","ev","move","documentMoveUrl","publishedAt","params","isShare","embedsDisabled","editor","getHeadings","showContents","ErrorBoundary","Background","component","Modal","DocumentMove","favicon","LoadingIndicator","justify","when","MaxWidth","archived","muted","PlaceholderIcon","archivedAt","deletedAt","Time","dateTime","updatedAt","permanentlyDeletedAt","PlaceholderDocument","join","onSearchLink","onCreateLink","onPublish","onCancel","readOnlyWriteCheckboxes","ReferencesWrapper","isOnlyTitle","isCustomDomain","InputIcon","HideSidebar","enableEditMode","disableEditMode","Loading","SocketPresence","setupOnce","context","previousContext","authenticated","emitJoin","on","emit","emitPresence","editingInterval","setInterval","USER_PRESENCE_INTERVAL","off","clearInterval","contextType","SocketContext","sharedTreeCache","DataLoader","term","time","NotFoundError","searchTitles","results","toLowerCase","newDocument","loadRevision","revisionId","revisions","loadDocument","documentSlug","response","error","read","catch","isMove","canonicalUrl","updateDocumentUrl","OfflineError","Error404","matchDocumentEdit","KeyedDocument","clearActiveDocument","urlParts","split"],"mappings":"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","file":"keyed-document.dfbbb01819649fd37542.js","sourcesContent":["// @flow\nimport styled from \"styled-components\";\n\nconst Notice = styled.p`\n  background: ${(props) => props.theme.sidebarBackground};\n  color: ${(props) => props.theme.sidebarText};\n  padding: 10px 12px;\n  border-radius: 4px;\n  position: relative;\n`;\n\nexport default Notice;\n","// @flow\nimport * as React from \"react\";\n\ntype Props = {\n  size?: number,\n  fill?: string,\n  className?: string,\n};\n\nfunction OutlineLogo({ size = 32, fill = \"#333\", className }: Props) {\n  return (\n    <svg\n      fill={fill}\n      width={size}\n      height={size}\n      viewBox=\"0 0 64 64\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      className={className}\n    >\n      <path d=\"M32,57.6 L32,59.1606101 C32,61.3697491 30.209139,63.1606101 28,63.1606101 C27.3130526,63.1606101 26.6376816,62.9836959 26.038955,62.6469122 L2.03895504,49.1469122 C0.779447116,48.438439 -4.3614532e-15,47.1057033 -7.10542736e-15,45.6606101 L-7.10542736e-15,18.3393899 C-7.28240024e-15,16.8942967 0.779447116,15.561561 2.03895504,14.8530878 L26.038955,1.35308779 C27.9643866,0.270032565 30.4032469,0.952913469 31.4863021,2.87834498 C31.8230858,3.47707155 32,4.15244252 32,4.83938994 L32,6.4 L34.8506085,5.54481746 C36.9665799,4.91002604 39.1965137,6.11075966 39.8313051,8.22673106 C39.9431692,8.59961116 40,8.98682435 40,9.3761226 L40,11 L43.5038611,10.5620174 C45.6959408,10.2880074 47.6951015,11.8429102 47.9691115,14.0349899 C47.9896839,14.1995692 48,14.3652688 48,14.5311289 L48,49.4688711 C48,51.6780101 46.209139,53.4688711 44,53.4688711 C43.8341399,53.4688711 43.6684404,53.458555 43.5038611,53.4379826 L40,53 L40,54.6238774 C40,56.8330164 38.209139,58.6238774 36,58.6238774 C35.6107017,58.6238774 35.2234886,58.5670466 34.8506085,58.4551825 L32,57.6 Z M32,53.4238774 L36,54.6238774 L36,9.3761226 L32,10.5761226 L32,53.4238774 Z M40,15.0311289 L40,48.9688711 L44,49.4688711 L44,14.5311289 L40,15.0311289 Z M5.32907052e-15,44.4688711 L5.32907052e-15,19.5311289 L3.55271368e-15,44.4688711 Z M4,18.3393899 L4,45.6606101 L28,59.1606101 L28,4.83938994 L4,18.3393899 Z M8,21 L12,19 L12,45 L8,43 L8,21 Z\" />\n    </svg>\n  );\n}\n\nexport default OutlineLogo;\n","// @flow\n\nexport default function parseDocumentSlug(url: string) {\n  let parsed;\n  if (url[0] === \"/\") {\n    parsed = url;\n  } else {\n    try {\n      parsed = new URL(url).pathname;\n    } catch (err) {\n      return;\n    }\n  }\n\n  return parsed.replace(/^\\/doc\\//, \"\");\n}\n","// @flow\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport CenteredContent from \"components/CenteredContent\";\nimport Empty from \"components/Empty\";\nimport PageTitle from \"components/PageTitle\";\n\nconst ErrorOffline = () => {\n  const { t } = useTranslation();\n\n  return (\n    <CenteredContent>\n      <PageTitle title={t(\"Offline\")} />\n      <h1>{t(\"Offline\")}</h1>\n      <Empty>{t(\"We were unable to load the document while offline.\")}</Empty>\n    </CenteredContent>\n  );\n};\n\nexport default ErrorOffline;\n","// @flow\n\nconst CHECKBOX_REGEX = /\\[(X|\\s|_|-)\\]\\s(.*)?/gi;\n\nexport default function getTasks(text: string) {\n  const matches = [...text.matchAll(CHECKBOX_REGEX)];\n  let total = matches.length;\n  if (!total) {\n    return {\n      completed: 0,\n      total: 0,\n    };\n  } else {\n    const notCompleted = matches.reduce(\n      (accumulator, match) =>\n        match[1] === \" \" ? accumulator + 1 : accumulator,\n      0\n    );\n    return { completed: total - notCompleted, total };\n  }\n}\n","// @flow\nimport * as React from \"react\";\nimport styled from \"styled-components\";\nimport OutlineLogo from \"./OutlineLogo\";\nimport env from \"env\";\n\ntype Props = {\n  href?: string,\n};\n\nfunction Branding({ href = env.URL }: Props) {\n  return (\n    <Link href={href}>\n      <OutlineLogo size={16} />\n      &nbsp;Outline\n    </Link>\n  );\n}\n\nconst Link = styled.a`\n  position: fixed;\n  bottom: 0;\n  left: 0;\n\n  font-weight: 600;\n  font-size: 14px;\n  text-decoration: none;\n  border-top-right-radius: 2px;\n  color: ${(props) => props.theme.text};\n  display: flex;\n  align-items: center;\n  padding: 16px;\n\n  svg {\n    fill: ${(props) => props.theme.text};\n  }\n\n  &:hover {\n    background: ${(props) => props.theme.sidebarBackground};\n  }\n`;\n\nexport default Branding;\n","// @flow\nimport styled from \"styled-components\";\nimport Flex from \"components/Flex\";\n\nconst Container = styled(Flex)`\n  position: relative;\n`;\n\nexport default Container;\n","// @flow\n// Based on https://github.com/rehooks/window-scroll-position which is no longer\n// maintained.\nimport { throttle } from \"lodash\";\nimport { useState, useEffect } from \"react\";\n\nlet supportsPassive = false;\ntry {\n  var opts = Object.defineProperty({}, \"passive\", {\n    get: function () {\n      supportsPassive = true;\n    },\n  });\n  window.addEventListener(\"testPassive\", null, opts);\n  window.removeEventListener(\"testPassive\", null, opts);\n} catch (e) {}\n\nconst getPosition = () => ({\n  x: window.pageXOffset,\n  y: window.pageYOffset,\n});\n\nconst defaultOptions = {\n  throttle: 100,\n};\n\nexport default function useWindowScrollPosition(options: {\n  throttle: number,\n}): { x: number, y: number } {\n  let opts = Object.assign({}, defaultOptions, options);\n\n  let [position, setPosition] = useState(getPosition());\n\n  useEffect(() => {\n    let handleScroll = throttle(() => {\n      setPosition(getPosition());\n    }, opts.throttle);\n\n    window.addEventListener(\n      \"scroll\",\n      handleScroll,\n      supportsPassive ? { passive: true } : false\n    );\n\n    return () => {\n      handleScroll.cancel();\n      window.removeEventListener(\"scroll\", handleScroll);\n    };\n  }, [opts.throttle]);\n\n  return position;\n}\n","// @flow\nimport * as React from \"react\";\nimport styled from \"styled-components\";\nimport breakpoint from \"styled-components-breakpoint\";\nimport HelpText from \"components/HelpText\";\nimport useWindowScrollPosition from \"hooks/useWindowScrollPosition\";\n\nconst HEADING_OFFSET = 20;\n\ntype Props = {\n  headings: { title: string, level: number, id: string }[],\n};\n\nexport default function Contents({ headings }: Props) {\n  const [activeSlug, setActiveSlug] = React.useState();\n  const position = useWindowScrollPosition({ throttle: 100 });\n\n  React.useEffect(() => {\n    for (let key = 0; key < headings.length; key++) {\n      const heading = headings[key];\n      const element = window.document.getElementById(\n        decodeURIComponent(heading.id)\n      );\n\n      if (element) {\n        const bounding = element.getBoundingClientRect();\n        if (bounding.top > HEADING_OFFSET) {\n          const last = headings[Math.max(0, key - 1)];\n          setActiveSlug(last.id);\n          return;\n        }\n      }\n    }\n  }, [position, headings]);\n\n  // calculate the minimum heading level and adjust all the headings to make\n  // that the top-most. This prevents the contents from being weirdly indented\n  // if all of the headings in the document are level 3, for example.\n  const minHeading = headings.reduce(\n    (memo, heading) => (heading.level < memo ? heading.level : memo),\n    Infinity\n  );\n  const headingAdjustment = minHeading - 1;\n\n  return (\n    <div>\n      <Wrapper>\n        <Heading>Contents</Heading>\n        {headings.length ? (\n          <List>\n            {headings.map((heading) => (\n              <ListItem\n                key={heading.id}\n                level={heading.level - headingAdjustment}\n                active={activeSlug === heading.id}\n              >\n                <Link href={`#${heading.id}`}>{heading.title}</Link>\n              </ListItem>\n            ))}\n          </List>\n        ) : (\n          <Empty>Headings you add to the document will appear here</Empty>\n        )}\n      </Wrapper>\n    </div>\n  );\n}\n\nconst Wrapper = styled(\"div\")`\n  display: none;\n  position: sticky;\n  top: 80px;\n  max-height: calc(100vh - 80px);\n\n  box-shadow: 1px 0 0 ${(props) => props.theme.divider};\n  margin-top: 40px;\n  margin-right: 2em;\n  min-height: 40px;\n  overflow-y: auto;\n\n  ${breakpoint(\"desktopLarge\")`\n    margin-left: -16em;\n  `};\n\n  ${breakpoint(\"tablet\")`\n    display: block;\n  `};\n`;\n\nconst Heading = styled(\"h3\")`\n  font-size: 11px;\n  font-weight: 600;\n  text-transform: uppercase;\n  color: ${(props) => props.theme.sidebarText};\n  letter-spacing: 0.04em;\n`;\n\nconst Empty = styled(HelpText)`\n  margin: 1em 0 4em;\n  padding-right: 2em;\n  min-width: 16em;\n  width: 16em;\n  font-size: 14px;\n`;\n\nconst ListItem = styled(\"li\")`\n  margin-left: ${(props) => (props.level - 1) * 10}px;\n  margin-bottom: 8px;\n  padding-right: 2em;\n  line-height: 1.3;\n  border-right: 3px solid\n    ${(props) => (props.active ? props.theme.divider : \"transparent\")};\n`;\n\nconst Link = styled(\"a\")`\n  color: ${(props) => props.theme.text};\n  font-size: 14px;\n\n  &:hover {\n    color: ${(props) => props.theme.primary};\n  }\n`;\n\nconst List = styled(\"ol\")`\n  min-width: 14em;\n  width: 14em;\n  padding: 0;\n  list-style: none;\n`;\n","// @flow\nimport styled from \"styled-components\";\n\nconst ClickablePadding = styled.div`\n  min-height: 10em;\n  cursor: ${({ onClick }) => (onClick ? \"text\" : \"default\")};\n  ${({ grow }) => grow && `flex-grow: 100;`};\n`;\n\nexport default ClickablePadding;\n","// @flow\nimport { formatDistanceToNow } from \"date-fns\";\nimport { sortBy } from \"lodash\";\nimport { observer } from \"mobx-react\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport Document from \"models/Document\";\nimport Avatar from \"components/Avatar\";\nimport ListItem from \"components/List/Item\";\nimport PaginatedList from \"components/PaginatedList\";\nimport useStores from \"hooks/useStores\";\n\ntype Props = {|\n  document: Document,\n  isOpen?: boolean,\n|};\n\nfunction DocumentViews({ document, isOpen }: Props) {\n  const { t } = useTranslation();\n  const { views, presence } = useStores();\n\n  let documentPresence = presence.get(document.id);\n  documentPresence = documentPresence\n    ? Array.from(documentPresence.values())\n    : [];\n\n  const presentIds = documentPresence.map((p) => p.userId);\n  const editingIds = documentPresence\n    .filter((p) => p.isEditing)\n    .map((p) => p.userId);\n\n  // ensure currently present via websocket are always ordered first\n  const documentViews = views.inDocument(document.id);\n  const sortedViews = sortBy(\n    documentViews,\n    (view) => !presentIds.includes(view.user.id)\n  );\n\n  const users = React.useMemo(() => sortedViews.map((v) => v.user), [\n    sortedViews,\n  ]);\n\n  return (\n    <>\n      {isOpen && (\n        <PaginatedList\n          items={users}\n          renderItem={(item) => {\n            const view = documentViews.find((v) => v.user.id === item.id);\n            const isPresent = presentIds.includes(item.id);\n            const isEditing = editingIds.includes(item.id);\n\n            const subtitle = isPresent\n              ? isEditing\n                ? t(\"Currently editing\")\n                : t(\"Currently viewing\")\n              : t(\"Viewed {{ timeAgo }} ago\", {\n                  timeAgo: formatDistanceToNow(\n                    view ? Date.parse(view.lastViewedAt) : new Date()\n                  ),\n                });\n\n            return (\n              <ListItem\n                key={item.id}\n                title={item.name}\n                subtitle={subtitle}\n                image={<Avatar key={item.id} src={item.avatarUrl} size={32} />}\n                border={false}\n                small\n              />\n            );\n          }}\n        />\n      )}\n    </>\n  );\n}\n\nexport default observer(DocumentViews);\n","// @flow\nimport * as React from \"react\";\nimport { Popover as ReakitPopover } from \"reakit/Popover\";\nimport styled from \"styled-components\";\nimport { fadeAndScaleIn } from \"styles/animations\";\n\ntype Props = {\n  children: React.Node,\n  width?: number,\n};\n\nfunction Popover({ children, width = 380, ...rest }: Props) {\n  return (\n    <ReakitPopover {...rest}>\n      <Contents width={width}>{children}</Contents>\n    </ReakitPopover>\n  );\n}\n\nconst Contents = styled.div`\n  animation: ${fadeAndScaleIn} 200ms ease;\n  transform-origin: 75% 0;\n  background: ${(props) => props.theme.menuBackground};\n  border-radius: 6px;\n  padding: 12px 24px;\n  max-height: 50vh;\n  overflow-y: scroll;\n  width: ${(props) => props.width}px;\n  box-shadow: ${(props) => props.theme.menuShadow};\n  border: ${(props) =>\n    props.theme.menuBorder ? `1px solid ${props.theme.menuBorder}` : \"none\"};\n`;\n\nexport default Popover;\n","// @flow\nimport { useObserver } from \"mobx-react\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { usePopoverState, PopoverDisclosure } from \"reakit/Popover\";\nimport styled from \"styled-components\";\nimport Document from \"models/Document\";\nimport DocumentMeta from \"components/DocumentMeta\";\nimport DocumentViews from \"components/DocumentViews\";\nimport Popover from \"components/Popover\";\nimport useStores from \"../hooks/useStores\";\n\ntype Props = {|\n  document: Document,\n  isDraft: boolean,\n  to?: string,\n  rtl?: boolean,\n|};\n\nfunction DocumentMetaWithViews({ to, isDraft, document, ...rest }: Props) {\n  const { views } = useStores();\n  const { t } = useTranslation();\n  const documentViews = useObserver(() => views.inDocument(document.id));\n  const totalViewers = documentViews.length;\n  const onlyYou = totalViewers === 1 && documentViews[0].user.id;\n\n  React.useEffect(() => {\n    if (!document.isDeleted) {\n      views.fetchPage({ documentId: document.id });\n    }\n  }, [views, document.id, document.isDeleted]);\n\n  const popover = usePopoverState({\n    gutter: 8,\n    placement: \"bottom\",\n    modal: true,\n  });\n\n  return (\n    <Meta document={document} to={to} {...rest}>\n      {totalViewers && !isDraft ? (\n        <PopoverDisclosure {...popover}>\n          {(props) => (\n            <>\n              &nbsp;&nbsp;\n              <a {...props}>\n                {t(\"Viewed by\")}{\" \"}\n                {onlyYou\n                  ? t(\"only you\")\n                  : `${totalViewers} ${\n                      totalViewers === 1 ? t(\"person\") : t(\"people\")\n                    }`}\n              </a>\n            </>\n          )}\n        </PopoverDisclosure>\n      ) : null}\n      <Popover {...popover} width={300} aria-label={t(\"Viewers\")} tabIndex={0}>\n        <DocumentViews document={document} isOpen={popover.visible} />\n      </Popover>\n    </Meta>\n  );\n}\n\nconst Meta = styled(DocumentMeta)`\n  justify-content: ${(props) => (props.rtl ? \"flex-end\" : \"flex-start\")};\n  margin: -12px 0 2em 0;\n  font-size: 14px;\n  position: relative;\n  z-index: 1;\n\n  a {\n    color: inherit;\n\n    &:hover {\n      text-decoration: underline;\n    }\n  }\n\n  @media print {\n    display: none;\n  }\n`;\n\nexport default DocumentMetaWithViews;\n","// @flow\nimport { observer } from \"mobx-react\";\nimport * as React from \"react\";\nimport { Link } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport parseDocumentSlug from \"shared/utils/parseDocumentSlug\";\nimport DocumentMetaWithViews from \"components/DocumentMetaWithViews\";\nimport Editor from \"components/Editor\";\nimport useStores from \"hooks/useStores\";\n\ntype Props = {\n  url: string,\n  children: (React.Node) => React.Node,\n};\n\nfunction HoverPreviewDocument({ url, children }: Props) {\n  const { documents } = useStores();\n  const slug = parseDocumentSlug(url);\n\n  documents.prefetchDocument(slug, {\n    prefetch: true,\n  });\n\n  const document = slug ? documents.getByUrl(slug) : undefined;\n  if (!document) return null;\n\n  return children(\n    <Content to={document.url}>\n      <Heading>{document.titleWithDefault}</Heading>\n      <DocumentMetaWithViews isDraft={document.isDraft} document={document} />\n\n      <React.Suspense fallback={<div />}>\n        <Editor\n          key={document.id}\n          defaultValue={document.getSummary()}\n          disableEmbeds\n          readOnly\n        />\n      </React.Suspense>\n    </Content>\n  );\n}\n\nconst Content = styled(Link)`\n  cursor: pointer;\n`;\n\nconst Heading = styled.h2`\n  margin: 0 0 0.75em;\n  color: ${(props) => props.theme.text};\n`;\n\nexport default observer(HoverPreviewDocument);\n","// @flow\nimport { inject } from \"mobx-react\";\nimport { transparentize } from \"polished\";\nimport * as React from \"react\";\nimport { Portal } from \"react-portal\";\nimport styled from \"styled-components\";\nimport parseDocumentSlug from \"shared/utils/parseDocumentSlug\";\nimport DocumentsStore from \"stores/DocumentsStore\";\nimport HoverPreviewDocument from \"components/HoverPreviewDocument\";\nimport { fadeAndSlideDown } from \"styles/animations\";\nimport { isInternalUrl } from \"utils/urls\";\n\nconst DELAY_OPEN = 300;\nconst DELAY_CLOSE = 300;\n\ntype Props = {\n  node: HTMLAnchorElement,\n  event: MouseEvent,\n  documents: DocumentsStore,\n  onClose: () => void,\n};\n\nfunction HoverPreviewInternal({ node, documents, onClose, event }: Props) {\n  const slug = parseDocumentSlug(node.href);\n\n  const [isVisible, setVisible] = React.useState(false);\n  const timerClose = React.useRef();\n  const timerOpen = React.useRef();\n  const cardRef = React.useRef<?HTMLDivElement>();\n\n  const startCloseTimer = () => {\n    stopOpenTimer();\n    timerClose.current = setTimeout(() => {\n      if (isVisible) setVisible(false);\n      onClose();\n    }, DELAY_CLOSE);\n  };\n\n  const stopCloseTimer = () => {\n    if (timerClose.current) {\n      clearTimeout(timerClose.current);\n    }\n  };\n\n  const startOpenTimer = () => {\n    timerOpen.current = setTimeout(() => setVisible(true), DELAY_OPEN);\n  };\n\n  const stopOpenTimer = () => {\n    if (timerOpen.current) {\n      clearTimeout(timerOpen.current);\n    }\n  };\n\n  React.useEffect(() => {\n    if (slug) {\n      documents.prefetchDocument(slug, {\n        prefetch: true,\n      });\n    }\n\n    startOpenTimer();\n\n    if (cardRef.current) {\n      cardRef.current.addEventListener(\"mouseenter\", stopCloseTimer);\n    }\n    if (cardRef.current) {\n      cardRef.current.addEventListener(\"mouseleave\", startCloseTimer);\n    }\n\n    node.addEventListener(\"mouseout\", startCloseTimer);\n    node.addEventListener(\"mouseover\", stopCloseTimer);\n    node.addEventListener(\"mouseover\", startOpenTimer);\n\n    return () => {\n      node.removeEventListener(\"mouseout\", startCloseTimer);\n      node.removeEventListener(\"mouseover\", stopCloseTimer);\n      node.removeEventListener(\"mouseover\", startOpenTimer);\n\n      if (cardRef.current) {\n        cardRef.current.removeEventListener(\"mouseenter\", stopCloseTimer);\n      }\n      if (cardRef.current) {\n        cardRef.current.removeEventListener(\"mouseleave\", startCloseTimer);\n      }\n\n      if (timerClose.current) {\n        clearTimeout(timerClose.current);\n      }\n    };\n  }, [node]);\n\n  const anchorBounds = node.getBoundingClientRect();\n  const cardBounds = cardRef.current\n    ? cardRef.current.getBoundingClientRect()\n    : undefined;\n  const left = cardBounds\n    ? Math.min(anchorBounds.left, window.innerWidth - 16 - 350)\n    : anchorBounds.left;\n  const leftOffset = anchorBounds.left - left;\n\n  return (\n    <Portal>\n      <Position\n        top={anchorBounds.bottom + window.scrollY}\n        left={left}\n        aria-hidden\n      >\n        <div ref={cardRef}>\n          <HoverPreviewDocument url={node.href}>\n            {(content) =>\n              isVisible ? (\n                <Animate>\n                  <Card>\n                    <Margin />\n                    <CardContent>{content}</CardContent>\n                  </Card>\n                  <Pointer offset={leftOffset + anchorBounds.width / 2} />\n                </Animate>\n              ) : null\n            }\n          </HoverPreviewDocument>\n        </div>\n      </Position>\n    </Portal>\n  );\n}\n\nfunction HoverPreview({ node, ...rest }: Props) {\n  // previews only work for internal doc links for now\n  if (!isInternalUrl(node.href)) {\n    return null;\n  }\n\n  return <HoverPreviewInternal {...rest} node={node} />;\n}\n\nconst Animate = styled.div`\n  animation: ${fadeAndSlideDown} 150ms ease;\n\n  @media print {\n    display: none;\n  }\n`;\n\n// fills the gap between the card and pointer to avoid a dead zone\nconst Margin = styled.div`\n  position: absolute;\n  top: -11px;\n  left: 0;\n  right: 0;\n  height: 11px;\n`;\n\nconst CardContent = styled.div`\n  overflow: hidden;\n  max-height: 350px;\n  user-select: none;\n`;\n\n// &:after  gradient mask for overflow text\nconst Card = styled.div`\n  backdrop-filter: blur(10px);\n  background: ${(props) => props.theme.background};\n  border: ${(props) =>\n    props.theme.menuBorder ? `1px solid ${props.theme.menuBorder}` : \"none\"};\n  border-radius: 4px;\n  box-shadow: 0 30px 90px -20px rgba(0, 0, 0, 0.3),\n    0 0 1px 1px rgba(0, 0, 0, 0.05);\n  padding: 16px;\n  width: 350px;\n  font-size: 0.9em;\n  position: relative;\n\n  .placeholder,\n  .heading-anchor {\n    display: none;\n  }\n\n  &:after {\n    content: \"\";\n    display: block;\n    position: absolute;\n    pointer-events: none;\n    background: linear-gradient(\n      90deg,\n      ${(props) => transparentize(1, props.theme.background)} 0%,\n      ${(props) => transparentize(1, props.theme.background)} 75%,\n      ${(props) => props.theme.background} 90%\n    );\n    bottom: 0;\n    left: 0;\n    right: 0;\n    height: 1.7em;\n    border-bottom: 16px solid ${(props) => props.theme.background};\n    border-bottom-left-radius: 4px;\n    border-bottom-right-radius: 4px;\n  }\n`;\n\nconst Position = styled.div`\n  margin-top: 10px;\n  position: ${({ fixed }) => (fixed ? \"fixed\" : \"absolute\")};\n  z-index: ${(props) => props.theme.depths.hoverPreview};\n  display: flex;\n  max-height: 75%;\n\n  ${({ top }) => (top !== undefined ? `top: ${top}px` : \"\")};\n  ${({ left }) => (left !== undefined ? `left: ${left}px` : \"\")};\n`;\n\nconst Pointer = styled.div`\n  top: -22px;\n  left: ${(props) => props.offset}px;\n  width: 22px;\n  height: 22px;\n  position: absolute;\n  transform: translateX(-50%);\n  pointer-events: none;\n\n  &:before,\n  &:after {\n    content: \"\";\n    display: inline-block;\n    position: absolute;\n    bottom: 0;\n    right: 0;\n  }\n\n  &:before {\n    border: 8px solid transparent;\n    border-bottom-color: ${(props) =>\n      props.theme.menuBorder || \"rgba(0, 0, 0, 0.1)\"};\n    right: -1px;\n  }\n\n  &:after {\n    border: 7px solid transparent;\n    border-bottom-color: ${(props) => props.theme.background};\n  }\n`;\n\nexport default inject(\"documents\")(HoverPreview);\n","// @flow\nimport { observable } from \"mobx\";\nimport { inject, observer } from \"mobx-react\";\nimport * as React from \"react\";\nimport Textarea from \"react-autosize-textarea\";\nimport { type TFunction, withTranslation } from \"react-i18next\";\nimport styled from \"styled-components\";\nimport breakpoint from \"styled-components-breakpoint\";\nimport { MAX_TITLE_LENGTH } from \"shared/constants\";\nimport { light } from \"shared/theme\";\nimport parseTitle from \"shared/utils/parseTitle\";\nimport PoliciesStore from \"stores/PoliciesStore\";\nimport Document from \"models/Document\";\nimport ClickablePadding from \"components/ClickablePadding\";\nimport DocumentMetaWithViews from \"components/DocumentMetaWithViews\";\nimport Editor, { type Props as EditorProps } from \"components/Editor\";\nimport Flex from \"components/Flex\";\nimport HoverPreview from \"components/HoverPreview\";\nimport Star, { AnimatedStar } from \"components/Star\";\nimport { isModKey } from \"utils/keyboard\";\nimport { documentHistoryUrl } from \"utils/routeHelpers\";\n\ntype Props = {|\n  ...EditorProps,\n  onChangeTitle: (event: SyntheticInputEvent<>) => void,\n  title: string,\n  document: Document,\n  isDraft: boolean,\n  shareId: ?string,\n  onSave: ({ done?: boolean, autosave?: boolean, publish?: boolean }) => any,\n  innerRef: { current: any },\n  children: React.Node,\n  policies: PoliciesStore,\n  t: TFunction,\n|};\n\n@observer\nclass DocumentEditor extends React.Component<Props> {\n  @observable activeLinkEvent: ?MouseEvent;\n  ref = React.createRef<HTMLDivElement | HTMLInputElement>();\n\n  focusAtStart = () => {\n    if (this.props.innerRef.current) {\n      this.props.innerRef.current.focusAtStart();\n    }\n  };\n\n  focusAtEnd = () => {\n    if (this.props.innerRef.current) {\n      this.props.innerRef.current.focusAtEnd();\n    }\n  };\n\n  insertParagraph = () => {\n    if (this.props.innerRef.current) {\n      const { view } = this.props.innerRef.current;\n      const { dispatch, state } = view;\n      dispatch(state.tr.insert(0, state.schema.nodes.paragraph.create()));\n    }\n  };\n\n  handleTitleKeyDown = (event: SyntheticKeyboardEvent<>) => {\n    if (event.key === \"Enter\") {\n      event.preventDefault();\n      if (isModKey(event)) {\n        this.props.onSave({ done: true });\n        return;\n      }\n\n      this.insertParagraph();\n      this.focusAtStart();\n      return;\n    }\n    if (event.key === \"Tab\" || event.key === \"ArrowDown\") {\n      event.preventDefault();\n      this.focusAtStart();\n      return;\n    }\n    if (event.key === \"p\" && isModKey(event) && event.shiftKey) {\n      event.preventDefault();\n      this.props.onSave({ publish: true, done: true });\n      return;\n    }\n    if (event.key === \"s\" && isModKey(event)) {\n      event.preventDefault();\n      this.props.onSave({});\n      return;\n    }\n  };\n\n  handleLinkActive = (event: MouseEvent) => {\n    this.activeLinkEvent = event;\n  };\n\n  handleLinkInactive = () => {\n    this.activeLinkEvent = null;\n  };\n\n  render() {\n    const {\n      document,\n      title,\n      onChangeTitle,\n      isDraft,\n      shareId,\n      readOnly,\n      innerRef,\n      children,\n      policies,\n      t,\n      ...rest\n    } = this.props;\n\n    const can = policies.abilities(document.id);\n    const { emoji } = parseTitle(title);\n    const startsWithEmojiAndSpace = !!(emoji && title.startsWith(`${emoji} `));\n    const normalizedTitle =\n      !title && readOnly ? document.titleWithDefault : title;\n\n    return (\n      <Flex auto column>\n        {readOnly ? (\n          <Title\n            as=\"div\"\n            ref={this.ref}\n            $startsWithEmojiAndSpace={startsWithEmojiAndSpace}\n            $isStarred={document.isStarred}\n            dir=\"auto\"\n          >\n            <span>{normalizedTitle}</span>{\" \"}\n            {(can.star || can.unstar) && (\n              <StarButton document={document} size={32} />\n            )}\n          </Title>\n        ) : (\n          <Title\n            type=\"text\"\n            ref={this.ref}\n            onChange={onChangeTitle}\n            onKeyDown={this.handleTitleKeyDown}\n            placeholder={\n              document.isTemplate\n                ? t(\"Start your template\")\n                : t(\"Start with a title\")\n            }\n            value={normalizedTitle}\n            $startsWithEmojiAndSpace={startsWithEmojiAndSpace}\n            autoFocus={!title}\n            maxLength={MAX_TITLE_LENGTH}\n            dir=\"auto\"\n          />\n        )}\n        {!shareId && (\n          <DocumentMetaWithViews\n            isDraft={isDraft}\n            document={document}\n            to={documentHistoryUrl(document)}\n            rtl={\n              this.ref.current\n                ? window.getComputedStyle(this.ref.current).direction === \"rtl\"\n                : false\n            }\n          />\n        )}\n        <Editor\n          ref={innerRef}\n          autoFocus={!!title && !this.props.defaultValue}\n          placeholder={t(\"the rest is up to you\")}\n          onHoverLink={this.handleLinkActive}\n          scrollTo={window.location.hash}\n          readOnly={readOnly}\n          shareId={shareId}\n          grow\n          {...rest}\n        />\n        {!readOnly && <ClickablePadding onClick={this.focusAtEnd} grow />}\n        {this.activeLinkEvent && !shareId && readOnly && (\n          <HoverPreview\n            node={this.activeLinkEvent.target}\n            event={this.activeLinkEvent}\n            onClose={this.handleLinkInactive}\n          />\n        )}\n        {children}\n      </Flex>\n    );\n  }\n}\n\nconst StarButton = styled(Star)`\n  position: relative;\n  top: 4px;\n`;\n\nconst Title = styled(Textarea)`\n  line-height: 1.25;\n  margin-top: 1em;\n  margin-bottom: 0.5em;\n  background: ${(props) => props.theme.background};\n  transition: ${(props) => props.theme.backgroundTransition};\n  color: ${(props) => props.theme.text};\n  -webkit-text-fill-color: ${(props) => props.theme.text};\n  font-size: 2.25em;\n  font-weight: 500;\n  outline: none;\n  border: 0;\n  padding: 0;\n  resize: none;\n\n  &::placeholder {\n    color: ${(props) => props.theme.placeholder};\n    -webkit-text-fill-color: ${(props) => props.theme.placeholder};\n  }\n\n  ${breakpoint(\"tablet\")`\n    margin-left: ${(props) => (props.$startsWithEmojiAndSpace ? \"-1.2em\" : 0)};\n  `};\n\n  ${AnimatedStar} {\n    opacity: ${(props) => (props.$isStarred ? \"1 !important\" : 0)};\n  }\n\n  &:hover {\n    ${AnimatedStar} {\n      opacity: 0.5;\n\n      &:hover {\n        opacity: 1;\n      }\n    }\n  }\n\n  @media print {\n    color: ${(props) => light.text};\n    -webkit-text-fill-color: ${(props) => light.text};\n    background: none;\n  }\n`;\n\nexport default withTranslation()<DocumentEditor>(\n  inject(\"policies\")(DocumentEditor)\n);\n","// @flow\nimport { sortBy, filter, uniq } from \"lodash\";\nimport { observer } from \"mobx-react\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { usePopoverState, PopoverDisclosure } from \"reakit/Popover\";\nimport styled from \"styled-components\";\nimport breakpoint from \"styled-components-breakpoint\";\nimport Document from \"models/Document\";\nimport { AvatarWithPresence } from \"components/Avatar\";\nimport DocumentViews from \"components/DocumentViews\";\nimport Facepile from \"components/Facepile\";\nimport NudeButton from \"components/NudeButton\";\nimport Popover from \"components/Popover\";\nimport useStores from \"hooks/useStores\";\n\ntype Props = {|\n  document: Document,\n  currentUserId: string,\n|};\n\nfunction Collaborators(props: Props) {\n  const { t } = useTranslation();\n  const { users, presence } = useStores();\n  const { document, currentUserId } = props;\n\n  let documentPresence = presence.get(document.id);\n  documentPresence = documentPresence\n    ? Array.from(documentPresence.values())\n    : [];\n\n  const presentIds = documentPresence.map((p) => p.userId);\n  const editingIds = documentPresence\n    .filter((p) => p.isEditing)\n    .map((p) => p.userId);\n\n  // ensure currently present via websocket are always ordered first\n  const collaborators = React.useMemo(\n    () =>\n      sortBy(\n        filter(\n          users.orderedData,\n          (user) =>\n            presentIds.includes(user.id) ||\n            document.collaboratorIds.includes(user.id)\n        ),\n        (user) => presentIds.includes(user.id)\n      ),\n    [document.collaboratorIds, users.orderedData, presentIds]\n  );\n\n  // load any users we don't know about\n  React.useEffect(() => {\n    if (users.isFetching) {\n      return;\n    }\n\n    uniq([...document.collaboratorIds, ...presentIds]).forEach((userId) => {\n      if (!users.get(userId)) {\n        return users.fetch(userId);\n      }\n    });\n  }, [document, users, presentIds, document.collaboratorIds]);\n\n  const popover = usePopoverState({\n    gutter: 0,\n    placement: \"bottom-end\",\n  });\n\n  return (\n    <>\n      <PopoverDisclosure {...popover}>\n        {(props) => (\n          <NudeButton width={collaborators.length * 32} height={32} {...props}>\n            <FacepileHiddenOnMobile\n              users={collaborators}\n              renderAvatar={(user) => {\n                const isPresent = presentIds.includes(user.id);\n                const isEditing = editingIds.includes(user.id);\n\n                return (\n                  <AvatarWithPresence\n                    key={user.id}\n                    user={user}\n                    isPresent={isPresent}\n                    isEditing={isEditing}\n                    isCurrentUser={currentUserId === user.id}\n                    profileOnClick={false}\n                  />\n                );\n              }}\n            />\n          </NudeButton>\n        )}\n      </PopoverDisclosure>\n      <Popover {...popover} width={300} aria-label={t(\"Viewers\")} tabIndex={0}>\n        <DocumentViews document={document} isOpen={popover.visible} />\n      </Popover>\n    </>\n  );\n}\n\nconst FacepileHiddenOnMobile = styled(Facepile)`\n  ${breakpoint(\"mobile\", \"tablet\")`\n    display: none;\n  `};\n`;\n\nexport default observer(Collaborators);\n","// @flow\nimport * as React from \"react\";\nimport Breadcrumb from \"components/Breadcrumb\";\nimport type { NavigationNode } from \"types\";\n\ntype Props = {|\n  documentId: string,\n  shareId: string,\n  sharedTree: ?NavigationNode,\n  children?: React.Node,\n|};\n\nfunction pathToDocument(sharedTree, documentId) {\n  let path = [];\n  const traveler = (nodes, previousPath) => {\n    nodes.forEach((childNode) => {\n      const newPath = [...previousPath, childNode];\n      if (childNode.id === documentId) {\n        path = newPath;\n        return;\n      }\n      return traveler(childNode.children, newPath);\n    });\n  };\n\n  if (sharedTree) {\n    traveler([sharedTree], []);\n  }\n  return path;\n}\n\nconst PublicBreadcrumb = ({\n  documentId,\n  shareId,\n  sharedTree,\n  children,\n}: Props) => {\n  const items = React.useMemo(\n    () =>\n      pathToDocument(sharedTree, documentId)\n        .slice(0, -1)\n        .map((item) => {\n          return {\n            ...item,\n            to: `/share/${shareId}${item.url}`,\n          };\n        }),\n    [sharedTree, shareId, documentId]\n  );\n\n  return <Breadcrumb items={items} children={children} />;\n};\n\nexport default PublicBreadcrumb;\n","// @flow\nimport { formatDistanceToNow } from \"date-fns\";\nimport invariant from \"invariant\";\nimport { observer } from \"mobx-react\";\nimport { GlobeIcon, PadlockIcon } from \"outline-icons\";\nimport * as React from \"react\";\nimport { useTranslation, Trans } from \"react-i18next\";\nimport styled from \"styled-components\";\nimport Document from \"models/Document\";\nimport Share from \"models/Share\";\nimport Button from \"components/Button\";\nimport CopyToClipboard from \"components/CopyToClipboard\";\nimport Flex from \"components/Flex\";\nimport HelpText from \"components/HelpText\";\nimport Input from \"components/Input\";\nimport Notice from \"components/Notice\";\nimport Switch from \"components/Switch\";\nimport useStores from \"hooks/useStores\";\nimport useToasts from \"hooks/useToasts\";\n\ntype Props = {|\n  document: Document,\n  share: Share,\n  sharedParent: ?Share,\n  onSubmit: () => void,\n|};\n\nfunction SharePopover({ document, share, sharedParent, onSubmit }: Props) {\n  const { t } = useTranslation();\n  const { policies, shares } = useStores();\n  const { showToast } = useToasts();\n  const [isCopied, setIsCopied] = React.useState(false);\n  const timeout = React.useRef<?TimeoutID>();\n  const can = policies.abilities(share ? share.id : \"\");\n  const canPublish = can.update && !document.isTemplate;\n  const isPubliclyShared = (share && share.published) || sharedParent;\n\n  React.useEffect(() => {\n    document.share();\n    return () => clearTimeout(timeout.current);\n  }, [document]);\n\n  const handlePublishedChange = React.useCallback(\n    async (event) => {\n      const share = shares.getByDocumentId(document.id);\n      invariant(share, \"Share must exist\");\n\n      try {\n        await share.save({ published: event.currentTarget.checked });\n      } catch (err) {\n        showToast(err.message, { type: \"error\" });\n      }\n    },\n    [document.id, shares, showToast]\n  );\n\n  const handleChildDocumentsChange = React.useCallback(\n    async (event) => {\n      const share = shares.getByDocumentId(document.id);\n      invariant(share, \"Share must exist\");\n\n      try {\n        await share.save({\n          includeChildDocuments: event.currentTarget.checked,\n        });\n      } catch (err) {\n        showToast(err.message, { type: \"error\" });\n      }\n    },\n    [document.id, shares, showToast]\n  );\n\n  const handleCopied = React.useCallback(() => {\n    setIsCopied(true);\n\n    timeout.current = setTimeout(() => {\n      setIsCopied(false);\n      onSubmit();\n\n      showToast(t(\"Share link copied\"), { type: \"info\" });\n    }, 250);\n  }, [t, onSubmit, showToast]);\n\n  return (\n    <>\n      <Heading>\n        {isPubliclyShared ? (\n          <GlobeIcon size={28} color=\"currentColor\" />\n        ) : (\n          <PadlockIcon size={28} color=\"currentColor\" />\n        )}{\" \"}\n        {t(\"Share this document\")}\n      </Heading>\n\n      {sharedParent && (\n        <Notice>\n          <Trans\n            defaults=\"This document is shared because the parent <em>{{ documentTitle }}</em> is publicly shared\"\n            values={{ documentTitle: sharedParent.documentTitle }}\n            components={{ em: <strong /> }}\n          />\n        </Notice>\n      )}\n\n      {canPublish && (\n        <SwitchWrapper>\n          <Switch\n            id=\"published\"\n            label={t(\"Publish to internet\")}\n            onChange={handlePublishedChange}\n            checked={share ? share.published : false}\n            disabled={!share}\n          />\n          <SwitchLabel>\n            <SwitchText>\n              {share.published\n                ? t(\"Anyone with the link can view this document\")\n                : t(\"Only team members with permission can view\")}\n              {share.lastAccessedAt && (\n                <>\n                  .{\" \"}\n                  {t(\"The shared link was last accessed {{ timeAgo }}.\", {\n                    timeAgo: formatDistanceToNow(\n                      Date.parse(share.lastAccessedAt),\n                      {\n                        addSuffix: true,\n                      }\n                    ),\n                  })}\n                </>\n              )}\n            </SwitchText>\n          </SwitchLabel>\n        </SwitchWrapper>\n      )}\n      {share && share.published && (\n        <SwitchWrapper>\n          <Switch\n            id=\"includeChildDocuments\"\n            label={t(\"Share nested documents\")}\n            onChange={handleChildDocumentsChange}\n            checked={share ? share.includeChildDocuments : false}\n            disabled={!share}\n          />\n          <SwitchLabel>\n            <SwitchText>\n              {share.includeChildDocuments\n                ? t(\"Nested documents are publicly available\")\n                : t(\"Nested documents are not shared\")}\n            </SwitchText>\n          </SwitchLabel>\n        </SwitchWrapper>\n      )}\n      <Flex>\n        <InputLink\n          type=\"text\"\n          label={t(\"Link\")}\n          placeholder={`${t(\"Loading\")}`}\n          value={share ? share.url : \"\"}\n          labelHidden\n          readOnly\n        />\n        <CopyToClipboard text={share ? share.url : \"\"} onCopy={handleCopied}>\n          <Button type=\"submit\" disabled={isCopied || !share} primary>\n            {t(\"Copy link\")}\n          </Button>\n        </CopyToClipboard>\n      </Flex>\n    </>\n  );\n}\n\nconst Heading = styled.h2`\n  display: flex;\n  align-items: center;\n  margin-top: 12px;\n  margin-left: -4px;\n`;\n\nconst SwitchWrapper = styled.div`\n  margin: 20px 0;\n`;\n\nconst InputLink = styled(Input)`\n  flex-grow: 1;\n  margin-right: 8px;\n`;\n\nconst SwitchLabel = styled(Flex)`\n  flex-align: center;\n\n  svg {\n    flex-shrink: 0;\n  }\n`;\n\nconst SwitchText = styled(HelpText)`\n  margin: 0;\n  font-size: 15px;\n`;\n\nexport default observer(SharePopover);\n","// @flow\nimport { observer } from \"mobx-react\";\nimport { GlobeIcon } from \"outline-icons\";\nimport * as React from \"react\";\nimport { useTranslation, Trans } from \"react-i18next\";\nimport { usePopoverState, PopoverDisclosure } from \"reakit/Popover\";\nimport Document from \"models/Document\";\nimport Button from \"components/Button\";\nimport Popover from \"components/Popover\";\nimport Tooltip from \"components/Tooltip\";\nimport SharePopover from \"./SharePopover\";\nimport useStores from \"hooks/useStores\";\n\ntype Props = {|\n  document: Document,\n|};\n\nfunction ShareButton({ document }: Props) {\n  const { t } = useTranslation();\n  const { shares } = useStores();\n  const share = shares.getByDocumentId(document.id);\n  const sharedParent = shares.getByDocumentParents(document.id);\n  const isPubliclyShared =\n    (share && share.published) || (sharedParent && sharedParent.published);\n  const popover = usePopoverState({\n    gutter: 0,\n    placement: \"bottom-end\",\n  });\n\n  return (\n    <>\n      <PopoverDisclosure {...popover}>\n        {(props) => (\n          <Tooltip\n            tooltip={\n              isPubliclyShared ? (\n                <Trans>\n                  Anyone with the link <br />\n                  can view this document\n                </Trans>\n              ) : (\n                \"\"\n              )\n            }\n            delay={500}\n            placement=\"bottom\"\n          >\n            <Button\n              icon={isPubliclyShared ? <GlobeIcon /> : undefined}\n              neutral\n              {...props}\n            >\n              {t(\"Share\")}\n            </Button>\n          </Tooltip>\n        )}\n      </PopoverDisclosure>\n      <Popover {...popover} aria-label={t(\"Share\")}>\n        <SharePopover\n          document={document}\n          share={share}\n          sharedParent={sharedParent}\n          onSubmit={popover.hide}\n        />\n      </Popover>\n    </>\n  );\n}\n\nexport default observer(ShareButton);\n","// @flow\nimport { observer } from \"mobx-react\";\nimport * as React from \"react\";\nimport { useTranslation, Trans } from \"react-i18next\";\nimport { useMenuState, MenuButton } from \"reakit/Menu\";\nimport Document from \"models/Document\";\nimport ContextMenu from \"components/ContextMenu\";\nimport Template from \"components/ContextMenu/Template\";\nimport useStores from \"hooks/useStores\";\nimport { newDocumentUrl } from \"utils/routeHelpers\";\n\ntype Props = {\n  label?: (any) => React.Node,\n  document: Document,\n};\n\nfunction NewChildDocumentMenu({ document, label }: Props) {\n  const menu = useMenuState({ modal: true });\n  const { collections } = useStores();\n  const { t } = useTranslation();\n  const collection = collections.get(document.collectionId);\n  const collectionName = collection ? collection.name : t(\"collection\");\n\n  return (\n    <>\n      <MenuButton {...menu}>{label}</MenuButton>\n      <ContextMenu {...menu} aria-label={t(\"New child document\")}>\n        <Template\n          {...menu}\n          items={[\n            {\n              title: (\n                <span>\n                  <Trans\n                    defaults=\"New document in <em>{{ collectionName }}</em>\"\n                    values={{ collectionName }}\n                    components={{ em: <strong /> }}\n                  />\n                </span>\n              ),\n              to: newDocumentUrl(document.collectionId),\n            },\n            {\n              title: t(\"New nested document\"),\n              to: newDocumentUrl(document.collectionId, {\n                parentDocumentId: document.id,\n              }),\n            },\n          ]}\n        />\n      </ContextMenu>\n    </>\n  );\n}\n\nexport default observer(NewChildDocumentMenu);\n","// @flow\nimport { observer } from \"mobx-react\";\nimport { TableOfContentsIcon } from \"outline-icons\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { MenuButton, useMenuState } from \"reakit/Menu\";\nimport Button from \"components/Button\";\nimport ContextMenu from \"components/ContextMenu\";\nimport Template from \"components/ContextMenu/Template\";\nimport { type MenuItem } from \"types\";\n\ntype Props = {|\n  headings: { title: string, level: number, id: string }[],\n|};\n\nfunction TableOfContentsMenu({ headings }: Props) {\n  const menu = useMenuState({\n    modal: true,\n    unstable_preventOverflow: true,\n    unstable_fixed: true,\n    unstable_flip: true,\n  });\n\n  const { t } = useTranslation();\n\n  const minHeading = headings.reduce(\n    (memo, heading) => (heading.level < memo ? heading.level : memo),\n    Infinity\n  );\n\n  const items: MenuItem[] = React.useMemo(() => {\n    let i = [\n      {\n        type: \"heading\",\n        visible: true,\n        title: t(\"Contents\"),\n      },\n      ...headings.map((heading) => ({\n        href: `#${heading.id}`,\n        title: t(heading.title),\n        level: heading.level - minHeading,\n      })),\n    ];\n\n    if (i.length === 1) {\n      i.push({\n        href: \"#\",\n        title: t(\"Headings you add to the document will appear here\"),\n        disabled: true,\n      });\n    }\n\n    return i;\n  }, [t, headings, minHeading]);\n\n  return (\n    <>\n      <MenuButton {...menu}>\n        {(props) => (\n          <Button\n            {...props}\n            icon={<TableOfContentsIcon />}\n            iconColor=\"currentColor\"\n            borderOnHover\n            neutral\n          />\n        )}\n      </MenuButton>\n      <ContextMenu {...menu} aria-label={t(\"Table of contents\")}>\n        <Template {...menu} items={items} />\n      </ContextMenu>\n    </>\n  );\n}\n\nexport default observer(TableOfContentsMenu);\n","// @flow\nimport { observer } from \"mobx-react\";\nimport { DocumentIcon } from \"outline-icons\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { MenuButton, useMenuState } from \"reakit/Menu\";\nimport styled from \"styled-components\";\nimport Document from \"models/Document\";\nimport Button from \"components/Button\";\nimport ContextMenu from \"components/ContextMenu\";\nimport MenuItem from \"components/ContextMenu/MenuItem\";\nimport Separator from \"components/ContextMenu/Separator\";\nimport useStores from \"hooks/useStores\";\n\ntype Props = {|\n  document: Document,\n|};\n\nfunction TemplatesMenu({ document }: Props) {\n  const menu = useMenuState({ modal: true });\n  const { documents } = useStores();\n  const { t } = useTranslation();\n  const templates = documents.templates;\n\n  if (!templates.length) {\n    return null;\n  }\n\n  const templatesInCollection = templates.filter(\n    (t) => t.collectionId === document.collectionId\n  );\n  const otherTemplates = templates.filter(\n    (t) => t.collectionId !== document.collectionId\n  );\n\n  const renderTemplate = (template) => (\n    <MenuItem\n      key={template.id}\n      onClick={() => document.updateFromTemplate(template)}\n      {...menu}\n    >\n      <DocumentIcon />\n      <TemplateItem>\n        <strong>{template.titleWithDefault}</strong>\n        <br />\n        <Author>\n          {t(\"By {{ author }}\", { author: template.createdBy.name })}\n        </Author>\n      </TemplateItem>\n    </MenuItem>\n  );\n\n  return (\n    <>\n      <MenuButton {...menu}>\n        {(props) => (\n          <Button {...props} disclosure neutral>\n            {t(\"Templates\")}\n          </Button>\n        )}\n      </MenuButton>\n      <ContextMenu {...menu} aria-label={t(\"Templates\")}>\n        {templatesInCollection.map(renderTemplate)}\n        {otherTemplates.length && templatesInCollection.length ? (\n          <Separator />\n        ) : undefined}\n        {otherTemplates.map(renderTemplate)}\n      </ContextMenu>\n    </>\n  );\n}\n\nconst TemplateItem = styled.div`\n  text-align: left;\n`;\n\nconst Author = styled.div`\n  font-size: 13px;\n`;\n\nexport default observer(TemplatesMenu);\n","// @flow\nimport { observer } from \"mobx-react\";\nimport {\n  TableOfContentsIcon,\n  EditIcon,\n  PlusIcon,\n  MoreIcon,\n} from \"outline-icons\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { Link } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport Document from \"models/Document\";\nimport { Action, Separator } from \"components/Actions\";\nimport Badge from \"components/Badge\";\nimport Button from \"components/Button\";\nimport Collaborators from \"components/Collaborators\";\nimport DocumentBreadcrumb from \"components/DocumentBreadcrumb\";\nimport Header from \"components/Header\";\nimport Tooltip from \"components/Tooltip\";\nimport PublicBreadcrumb from \"./PublicBreadcrumb\";\nimport ShareButton from \"./ShareButton\";\nimport useMobile from \"hooks/useMobile\";\nimport useStores from \"hooks/useStores\";\nimport DocumentMenu from \"menus/DocumentMenu\";\nimport NewChildDocumentMenu from \"menus/NewChildDocumentMenu\";\nimport TableOfContentsMenu from \"menus/TableOfContentsMenu\";\nimport TemplatesMenu from \"menus/TemplatesMenu\";\nimport { type NavigationNode } from \"types\";\nimport { metaDisplay } from \"utils/keyboard\";\nimport { newDocumentUrl, editDocumentUrl } from \"utils/routeHelpers\";\n\ntype Props = {|\n  document: Document,\n  sharedTree: ?NavigationNode,\n  shareId: ?string,\n  isDraft: boolean,\n  isEditing: boolean,\n  isRevision: boolean,\n  isSaving: boolean,\n  isPublishing: boolean,\n  publishingIsDisabled: boolean,\n  savingIsDisabled: boolean,\n  onDiscard: () => void,\n  onSave: ({\n    done?: boolean,\n    publish?: boolean,\n    autosave?: boolean,\n  }) => void,\n  headings: { title: string, level: number, id: string }[],\n|};\n\nfunction DocumentHeader({\n  document,\n  shareId,\n  isEditing,\n  isDraft,\n  isPublishing,\n  isRevision,\n  isSaving,\n  savingIsDisabled,\n  publishingIsDisabled,\n  sharedTree,\n  onSave,\n  headings,\n}: Props) {\n  const { t } = useTranslation();\n  const { auth, ui, policies } = useStores();\n  const isMobile = useMobile();\n\n  const handleSave = React.useCallback(() => {\n    onSave({ done: true });\n  }, [onSave]);\n\n  const handlePublish = React.useCallback(() => {\n    onSave({ done: true, publish: true });\n  }, [onSave]);\n\n  const isNew = document.isNewDocument;\n  const isTemplate = document.isTemplate;\n  const can = policies.abilities(document.id);\n  const canShareDocument = auth.team && auth.team.sharing && can.share;\n  const canToggleEmbeds = auth.team && auth.team.documentEmbeds;\n  const canEdit = can.update && !isEditing;\n\n  const toc = (\n    <Tooltip\n      tooltip={ui.tocVisible ? t(\"Hide contents\") : t(\"Show contents\")}\n      shortcut=\"ctrl+alt+h\"\n      delay={250}\n      placement=\"bottom\"\n    >\n      <Button\n        onClick={\n          ui.tocVisible ? ui.hideTableOfContents : ui.showTableOfContents\n        }\n        icon={<TableOfContentsIcon />}\n        iconColor=\"currentColor\"\n        borderOnHover\n        neutral\n      />\n    </Tooltip>\n  );\n\n  const editAction = (\n    <Action>\n      <Tooltip\n        tooltip={t(\"Edit {{noun}}\", { noun: document.noun })}\n        shortcut=\"e\"\n        delay={500}\n        placement=\"bottom\"\n      >\n        <Button\n          as={Link}\n          icon={<EditIcon />}\n          to={editDocumentUrl(document)}\n          neutral\n        >\n          {t(\"Edit\")}\n        </Button>\n      </Tooltip>\n    </Action>\n  );\n\n  if (shareId) {\n    return (\n      <Header\n        title={document.title}\n        breadcrumb={\n          <PublicBreadcrumb\n            documentId={document.id}\n            shareId={shareId}\n            sharedTree={sharedTree}\n          >\n            {toc}\n          </PublicBreadcrumb>\n        }\n        actions={canEdit ? editAction : <div />}\n      />\n    );\n  }\n\n  return (\n    <>\n      <Header\n        breadcrumb={\n          <DocumentBreadcrumb document={document}>\n            {!isEditing && toc}\n          </DocumentBreadcrumb>\n        }\n        title={\n          <>\n            {document.title}{\" \"}\n            {document.isArchived && <Badge>{t(\"Archived\")}</Badge>}\n          </>\n        }\n        actions={\n          <>\n            {isMobile && (\n              <TocWrapper>\n                <TableOfContentsMenu headings={headings} />\n              </TocWrapper>\n            )}\n            {!isPublishing && isSaving && <Status>{t(\"Saving\")}</Status>}\n            <Collaborators\n              document={document}\n              currentUserId={auth.user ? auth.user.id : undefined}\n            />\n            {isEditing && !isTemplate && isNew && (\n              <Action>\n                <TemplatesMenu document={document} />\n              </Action>\n            )}\n            {!isEditing && canShareDocument && (!isMobile || !isTemplate) && (\n              <Action>\n                <ShareButton document={document} />\n              </Action>\n            )}\n            {isEditing && (\n              <>\n                <Action>\n                  <Tooltip\n                    tooltip={t(\"Save\")}\n                    shortcut={`${metaDisplay}+enter`}\n                    delay={500}\n                    placement=\"bottom\"\n                  >\n                    <Button\n                      onClick={handleSave}\n                      disabled={savingIsDisabled}\n                      neutral={isDraft}\n                    >\n                      {isDraft ? t(\"Save Draft\") : t(\"Done Editing\")}\n                    </Button>\n                  </Tooltip>\n                </Action>\n              </>\n            )}\n            {canEdit && editAction}\n            {canEdit && can.createChildDocument && !isMobile && (\n              <Action>\n                <NewChildDocumentMenu\n                  document={document}\n                  label={(props) => (\n                    <Tooltip\n                      tooltip={t(\"New document\")}\n                      shortcut=\"n\"\n                      delay={500}\n                      placement=\"bottom\"\n                    >\n                      <Button icon={<PlusIcon />} {...props} neutral>\n                        {t(\"New doc\")}\n                      </Button>\n                    </Tooltip>\n                  )}\n                />\n              </Action>\n            )}\n            {canEdit && isTemplate && !isDraft && !isRevision && (\n              <Action>\n                <Button\n                  icon={<PlusIcon />}\n                  as={Link}\n                  to={newDocumentUrl(document.collectionId, {\n                    templateId: document.id,\n                  })}\n                  primary\n                >\n                  {t(\"New from template\")}\n                </Button>\n              </Action>\n            )}\n            {can.update && isDraft && !isRevision && (\n              <Action>\n                <Tooltip\n                  tooltip={t(\"Publish\")}\n                  shortcut={`${metaDisplay}+shift+p`}\n                  delay={500}\n                  placement=\"bottom\"\n                >\n                  <Button\n                    onClick={handlePublish}\n                    disabled={publishingIsDisabled}\n                  >\n                    {isPublishing ? `${t(\"Publishing\")}` : t(\"Publish\")}\n                  </Button>\n                </Tooltip>\n              </Action>\n            )}\n            {!isEditing && (\n              <>\n                <Separator />\n                <Action>\n                  <DocumentMenu\n                    document={document}\n                    isRevision={isRevision}\n                    label={(props) => (\n                      <Button\n                        icon={<MoreIcon />}\n                        iconColor=\"currentColor\"\n                        {...props}\n                        borderOnHover\n                        neutral\n                      />\n                    )}\n                    showToggleEmbeds={canToggleEmbeds}\n                    showPrint\n                  />\n                </Action>\n              </>\n            )}\n          </>\n        }\n      />\n    </>\n  );\n}\n\nconst Status = styled(Action)`\n  padding-left: 0;\n  padding-right: 4px;\n  color: ${(props) => props.theme.slate};\n`;\n\nconst TocWrapper = styled(Action)`\n  position: absolute;\n  left: 42px;\n`;\n\nexport default observer(DocumentHeader);\n","// @flow\nimport { useTheme } from \"styled-components\";\nimport useMediaQuery from \"hooks/useMediaQuery\";\n\nexport default function useMobile(): boolean {\n  const theme = useTheme();\n  return useMediaQuery(`(max-width: ${theme.breakpoints.tablet}px)`);\n}\n","// @flow\nimport { KeyboardIcon } from \"outline-icons\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport styled from \"styled-components\";\nimport breakpoint from \"styled-components-breakpoint\";\nimport KeyboardShortcuts from \"scenes/KeyboardShortcuts\";\nimport Guide from \"components/Guide\";\nimport NudeButton from \"components/NudeButton\";\nimport Tooltip from \"components/Tooltip\";\nimport useBoolean from \"hooks/useBoolean\";\n\nfunction KeyboardShortcutsButton() {\n  const { t } = useTranslation();\n  const [\n    keyboardShortcutsOpen,\n    handleOpenKeyboardShortcuts,\n    handleCloseKeyboardShortcuts,\n  ] = useBoolean();\n\n  return (\n    <>\n      <Guide\n        isOpen={keyboardShortcutsOpen}\n        onRequestClose={handleCloseKeyboardShortcuts}\n        title={t(\"Keyboard shortcuts\")}\n      >\n        <KeyboardShortcuts />\n      </Guide>\n      <Tooltip\n        tooltip={t(\"Keyboard shortcuts\")}\n        shortcut=\"?\"\n        placement=\"left\"\n        delay={500}\n      >\n        <Button onClick={handleOpenKeyboardShortcuts}>\n          <KeyboardIcon />\n        </Button>\n      </Tooltip>\n    </>\n  );\n}\n\nconst Button = styled(NudeButton)`\n  display: none;\n  position: fixed;\n  bottom: 0;\n  right: 0;\n  margin: 24px;\n\n  ${breakpoint(\"tablet\")`\n    display: block;\n  `};\n\n  @media print {\n    display: none;\n  }\n`;\n\nexport default KeyboardShortcutsButton;\n","// @flow\nimport * as React from \"react\";\nimport Document from \"models/Document\";\n\nconst MARK_AS_VIEWED_AFTER = 3 * 1000;\n\ntype Props = {|\n  document: Document,\n  children?: React.Node,\n|};\n\nclass MarkAsViewed extends React.Component<Props> {\n  viewTimeout: TimeoutID;\n\n  componentDidMount() {\n    const { document } = this.props;\n\n    this.viewTimeout = setTimeout(async () => {\n      const view = await document.view();\n\n      if (view) {\n        document.updateLastViewed(view);\n      }\n    }, MARK_AS_VIEWED_AFTER);\n  }\n\n  componentWillUnmount() {\n    clearTimeout(this.viewTimeout);\n  }\n\n  render() {\n    return this.props.children || null;\n  }\n}\n\nexport default MarkAsViewed;\n","// @flow\nimport { observer } from \"mobx-react\";\nimport { DocumentIcon } from \"outline-icons\";\nimport * as React from \"react\";\nimport { Link } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport Document from \"models/Document\";\nimport DocumentMeta from \"components/DocumentMeta\";\nimport type { NavigationNode } from \"types\";\n\ntype Props = {|\n  shareId?: string,\n  document: Document | NavigationNode,\n  anchor?: string,\n  showCollection?: boolean,\n|};\n\nconst DocumentLink = styled(Link)`\n  display: block;\n  margin: 2px -8px;\n  padding: 6px 8px;\n  border-radius: 8px;\n  max-height: 50vh;\n  min-width: 100%;\n  overflow: hidden;\n  position: relative;\n\n  &:hover,\n  &:active,\n  &:focus {\n    background: ${(props) => props.theme.listItemHoverBackground};\n  }\n`;\n\nconst Title = styled.h3`\n  display: flex;\n  align-items: center;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  font-size: 14px;\n  margin-top: 0;\n  margin-bottom: 0.25em;\n  white-space: nowrap;\n  color: ${(props) => props.theme.text};\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Oxygen,\n    Ubuntu, Cantarell, \"Open Sans\", \"Helvetica Neue\", sans-serif;\n`;\n\nconst StyledDocumentIcon = styled(DocumentIcon)`\n  margin-left: -4px;\n  color: ${(props) => props.theme.textSecondary};\n`;\n\nconst Emoji = styled.span`\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: -4px;\n  font-size: 16px;\n  width: 24px;\n  height: 24px;\n`;\n\nfunction ReferenceListItem({\n  document,\n  showCollection,\n  anchor,\n  shareId,\n  ...rest\n}: Props) {\n  return (\n    <DocumentLink\n      to={{\n        pathname: shareId ? `/share/${shareId}${document.url}` : document.url,\n        hash: anchor ? `d-${anchor}` : undefined,\n        state: { title: document.title },\n      }}\n      {...rest}\n    >\n      <Title dir=\"auto\">\n        {document.emoji ? (\n          <Emoji>{document.emoji}</Emoji>\n        ) : (\n          <StyledDocumentIcon color=\"currentColor\" />\n        )}{\" \"}\n        {document.emoji\n          ? document.title.replace(new RegExp(`^${document.emoji}`), \"\")\n          : document.title}\n      </Title>\n      {document.updatedBy && (\n        <DocumentMeta document={document} showCollection={showCollection} />\n      )}\n    </DocumentLink>\n  );\n}\n\nexport default observer(ReferenceListItem);\n","// @flow\nimport { observer } from \"mobx-react\";\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport Subheading from \"components/Subheading\";\nimport ReferenceListItem from \"./ReferenceListItem\";\nimport { type NavigationNode } from \"types\";\n\ntype Props = {|\n  shareId: string,\n  documentId: string,\n  sharedTree: NavigationNode,\n|};\n\nfunction PublicReferences(props: Props) {\n  const { t } = useTranslation();\n  const { shareId, documentId, sharedTree } = props;\n\n  // The sharedTree is the entire document tree starting at the shared document\n  // we must filter down the tree to only the part with the document we're\n  // currently viewing\n  const children = React.useMemo(() => {\n    let result;\n\n    function findChildren(node) {\n      if (!node) return;\n      if (node.id === documentId) {\n        result = node.children;\n      } else {\n        node.children.forEach((node) => {\n          if (result) {\n            return;\n          }\n          findChildren(node);\n        });\n      }\n      return result;\n    }\n\n    return findChildren(sharedTree) || [];\n  }, [documentId, sharedTree]);\n\n  if (!children.length) {\n    return null;\n  }\n\n  return (\n    <>\n      <Subheading>{t(\"Nested documents\")}</Subheading>\n      {children.map((node) => (\n        <ReferenceListItem key={node.id} document={node} shareId={shareId} />\n      ))}\n    </>\n  );\n}\n\nexport default observer(PublicReferences);\n","// @flow\nimport { observer, inject } from \"mobx-react\";\nimport * as React from \"react\";\nimport { withRouter, type Location } from \"react-router-dom\";\nimport CollectionsStore from \"stores/CollectionsStore\";\nimport DocumentsStore from \"stores/DocumentsStore\";\nimport Document from \"models/Document\";\nimport Fade from \"components/Fade\";\nimport Tab from \"components/Tab\";\nimport Tabs from \"components/Tabs\";\nimport ReferenceListItem from \"./ReferenceListItem\";\n\ntype Props = {\n  document: Document,\n  documents: DocumentsStore,\n  collections: CollectionsStore,\n  location: Location,\n};\n\n@observer\nclass References extends React.Component<Props> {\n  componentDidMount() {\n    this.props.documents.fetchBacklinks(this.props.document.id);\n  }\n\n  render() {\n    const { documents, collections, document } = this.props;\n    const backlinks = documents.getBacklinedDocuments(document.id);\n    const collection = collections.get(document.collectionId);\n    const children = collection\n      ? collection.getDocumentChildren(document.id)\n      : [];\n\n    const showBacklinks = !!backlinks.length;\n    const showNestedDocuments = !!children.length;\n    const isBacklinksTab =\n      this.props.location.hash === \"#backlinks\" || !showNestedDocuments;\n\n    return (\n      (showBacklinks || showNestedDocuments) && (\n        <Fade>\n          <Tabs>\n            {showNestedDocuments && (\n              <Tab to=\"#children\" isActive={() => !isBacklinksTab}>\n                Nested documents\n              </Tab>\n            )}\n            {showBacklinks && (\n              <Tab to=\"#backlinks\" isActive={() => isBacklinksTab}>\n                Referenced by\n              </Tab>\n            )}\n          </Tabs>\n          {isBacklinksTab\n            ? backlinks.map((backlinkedDocument) => (\n                <ReferenceListItem\n                  anchor={document.urlId}\n                  key={backlinkedDocument.id}\n                  document={backlinkedDocument}\n                  showCollection={\n                    backlinkedDocument.collectionId !== document.collectionId\n                  }\n                />\n              ))\n            : children.map((node) => {\n                // If we have the document in the store already then use it to get the extra\n                // contextual info, otherwise the collection node will do (only has title and id)\n                const document = documents.get(node.id);\n                return (\n                  <ReferenceListItem\n                    key={node.id}\n                    document={document || node}\n                    showCollection={false}\n                  />\n                );\n              })}\n        </Fade>\n      )\n    );\n  }\n}\n\nexport default withRouter(inject(\"documents\", \"collections\")(References));\n","// @flow\nimport { debounce } from \"lodash\";\nimport { observable } from \"mobx\";\nimport { observer, inject } from \"mobx-react\";\nimport { InputIcon } from \"outline-icons\";\nimport * as React from \"react\";\nimport { type TFunction, Trans, withTranslation } from \"react-i18next\";\nimport keydown from \"react-keydown\";\nimport { Prompt, Route, withRouter } from \"react-router-dom\";\nimport type { RouterHistory, Match } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport breakpoint from \"styled-components-breakpoint\";\nimport getTasks from \"shared/utils/getTasks\";\nimport AuthStore from \"stores/AuthStore\";\nimport ToastsStore from \"stores/ToastsStore\";\nimport UiStore from \"stores/UiStore\";\nimport Document from \"models/Document\";\nimport Revision from \"models/Revision\";\nimport DocumentMove from \"scenes/DocumentMove\";\nimport Branding from \"components/Branding\";\nimport ErrorBoundary from \"components/ErrorBoundary\";\nimport Flex from \"components/Flex\";\nimport LoadingIndicator from \"components/LoadingIndicator\";\nimport Modal from \"components/Modal\";\nimport Notice from \"components/Notice\";\nimport PageTitle from \"components/PageTitle\";\nimport PlaceholderDocument from \"components/PlaceholderDocument\";\nimport Time from \"components/Time\";\nimport Container from \"./Container\";\nimport Contents from \"./Contents\";\nimport Editor from \"./Editor\";\nimport Header from \"./Header\";\nimport KeyboardShortcutsButton from \"./KeyboardShortcutsButton\";\nimport MarkAsViewed from \"./MarkAsViewed\";\nimport PublicReferences from \"./PublicReferences\";\nimport References from \"./References\";\nimport { type LocationWithState, type NavigationNode, type Theme } from \"types\";\nimport { isCustomDomain } from \"utils/domains\";\nimport { emojiToUrl } from \"utils/emoji\";\nimport { meta } from \"utils/keyboard\";\nimport {\n  documentMoveUrl,\n  documentHistoryUrl,\n  editDocumentUrl,\n  documentUrl,\n} from \"utils/routeHelpers\";\n\nconst AUTOSAVE_DELAY = 3000;\nconst IS_DIRTY_DELAY = 500;\ntype Props = {\n  match: Match,\n  history: RouterHistory,\n  location: LocationWithState,\n  sharedTree: ?NavigationNode,\n  abilities: Object,\n  document: Document,\n  revision: Revision,\n  readOnly: boolean,\n  onCreateLink: (title: string) => Promise<string>,\n  onSearchLink: (term: string) => any,\n  theme: Theme,\n  auth: AuthStore,\n  ui: UiStore,\n  toasts: ToastsStore,\n  t: TFunction,\n};\n\n@observer\nclass DocumentScene extends React.Component<Props> {\n  @observable editor = React.createRef();\n  @observable isUploading: boolean = false;\n  @observable isSaving: boolean = false;\n  @observable isPublishing: boolean = false;\n  @observable isDirty: boolean = false;\n  @observable isEmpty: boolean = true;\n  @observable lastRevision: number = this.props.document.revision;\n  @observable title: string = this.props.document.title;\n  getEditorText: () => string = () => this.props.document.text;\n\n  componentDidMount() {\n    this.updateIsDirty();\n  }\n\n  componentDidUpdate(prevProps) {\n    const { auth, document, t } = this.props;\n\n    if (prevProps.readOnly && !this.props.readOnly) {\n      this.updateIsDirty();\n    }\n\n    if (this.props.readOnly) {\n      this.lastRevision = document.revision;\n\n      if (document.title !== this.title) {\n        this.title = document.title;\n      }\n    } else if (prevProps.document.revision !== this.lastRevision) {\n      if (auth.user && document.updatedBy.id !== auth.user.id) {\n        this.props.toasts.showToast(\n          t(`Document updated by {{userName}}`, {\n            userName: document.updatedBy.name,\n          }),\n          {\n            timeout: 30 * 1000,\n            type: \"warning\",\n            action: {\n              text: \"Reload\",\n              onClick: () => {\n                window.location.href = documentUrl(document);\n              },\n            },\n          }\n        );\n      }\n    }\n\n    if (document.injectTemplate) {\n      document.injectTemplate = false;\n      this.title = document.title;\n      this.isDirty = true;\n      this.updateIsDirty();\n    }\n  }\n\n  @keydown(\"m\")\n  goToMove(ev) {\n    if (!this.props.readOnly) return;\n\n    ev.preventDefault();\n    const { document, abilities } = this.props;\n\n    if (abilities.move) {\n      this.props.history.push(documentMoveUrl(document));\n    }\n  }\n\n  @keydown(\"e\")\n  goToEdit(ev) {\n    if (!this.props.readOnly) return;\n\n    ev.preventDefault();\n    const { document, abilities } = this.props;\n\n    if (abilities.update) {\n      this.props.history.push(editDocumentUrl(document));\n    }\n  }\n\n  @keydown(\"esc\")\n  goBack(ev) {\n    if (this.props.readOnly) return;\n\n    ev.preventDefault();\n    this.props.history.goBack();\n  }\n\n  @keydown(\"h\")\n  goToHistory(ev) {\n    if (!this.props.readOnly) return;\n\n    ev.preventDefault();\n    const { document, revision } = this.props;\n\n    if (revision) {\n      this.props.history.push(document.url);\n    } else {\n      this.props.history.push(documentHistoryUrl(document));\n    }\n  }\n\n  @keydown(`${meta}+shift+p`)\n  onPublish(ev) {\n    ev.preventDefault();\n    const { document } = this.props;\n    if (document.publishedAt) return;\n    this.onSave({ publish: true, done: true });\n  }\n\n  @keydown(\"ctrl+alt+h\")\n  onToggleTableOfContents(ev) {\n    if (!this.props.readOnly) return;\n\n    ev.preventDefault();\n    const { ui } = this.props;\n\n    if (ui.tocVisible) {\n      ui.hideTableOfContents();\n    } else {\n      ui.showTableOfContents();\n    }\n  }\n\n  onSave = async (\n    options: {\n      done?: boolean,\n      publish?: boolean,\n      autosave?: boolean,\n    } = {}\n  ) => {\n    const { document } = this.props;\n\n    // prevent saves when we are already saving\n    if (document.isSaving) return;\n\n    // get the latest version of the editor text value\n    const text = this.getEditorText ? this.getEditorText() : document.text;\n    const title = this.title;\n\n    // prevent save before anything has been written (single hash is empty doc)\n    if (text.trim() === \"\" && title.trim === \"\") return;\n\n    // prevent autosave if nothing has changed\n    if (\n      options.autosave &&\n      document.text.trim() === text.trim() &&\n      document.title.trim() === title.trim()\n    )\n      return;\n\n    document.title = title;\n    document.text = text;\n\n    let isNew = !document.id;\n    this.isSaving = true;\n    this.isPublishing = !!options.publish;\n\n    document.tasks = getTasks(document.text);\n\n    try {\n      const savedDocument = await document.save({\n        ...options,\n        lastRevision: this.lastRevision,\n      });\n      this.isDirty = false;\n      this.lastRevision = savedDocument.revision;\n\n      if (options.done) {\n        this.props.history.push(savedDocument.url);\n        this.props.ui.setActiveDocument(savedDocument);\n      } else if (isNew) {\n        this.props.history.push(editDocumentUrl(savedDocument));\n        this.props.ui.setActiveDocument(savedDocument);\n      }\n    } catch (err) {\n      this.props.toasts.showToast(err.message, { type: \"error\" });\n    } finally {\n      this.isSaving = false;\n      this.isPublishing = false;\n    }\n  };\n\n  autosave = debounce(() => {\n    this.onSave({ done: false, autosave: true });\n  }, AUTOSAVE_DELAY);\n\n  updateIsDirty = () => {\n    const { document } = this.props;\n    const editorText = this.getEditorText().trim();\n    const titleChanged = this.title !== document.title;\n    const bodyChanged = editorText !== document.text.trim();\n\n    // a single hash is a doc with just an empty title\n    this.isEmpty = (!editorText || editorText === \"#\") && !this.title;\n    this.isDirty = bodyChanged || titleChanged;\n  };\n\n  updateIsDirtyDebounced = debounce(this.updateIsDirty, IS_DIRTY_DELAY);\n\n  onImageUploadStart = () => {\n    this.isUploading = true;\n  };\n\n  onImageUploadStop = () => {\n    this.isUploading = false;\n  };\n\n  onChange = (getEditorText) => {\n    this.getEditorText = getEditorText;\n\n    // document change while read only is presumed to be a checkbox edit,\n    // in that case we don't delay in saving for a better user experience.\n    if (this.props.readOnly) {\n      this.updateIsDirty();\n      this.onSave({ done: false, autosave: true });\n    } else {\n      this.updateIsDirtyDebounced();\n      this.autosave();\n    }\n  };\n\n  onChangeTitle = (event) => {\n    this.title = event.target.value;\n    this.updateIsDirtyDebounced();\n    this.autosave();\n  };\n\n  goBack = () => {\n    this.props.history.push(this.props.document.url);\n  };\n\n  render() {\n    const {\n      document,\n      revision,\n      readOnly,\n      abilities,\n      auth,\n      ui,\n      match,\n      t,\n    } = this.props;\n    const team = auth.team;\n    const { shareId } = match.params;\n    const isShare = !!shareId;\n\n    const value = revision ? revision.text : document.text;\n    const injectTemplate = document.injectTemplate;\n    const disableEmbeds =\n      (team && team.documentEmbeds === false) || document.embedsDisabled;\n\n    const headings = this.editor.current\n      ? this.editor.current.getHeadings()\n      : [];\n    const showContents = ui.tocVisible && readOnly;\n\n    return (\n      <ErrorBoundary>\n        <Background\n          key={revision ? revision.id : document.id}\n          isShare={isShare}\n          column\n          auto\n        >\n          <Route\n            path={`${match.url}/move`}\n            component={() => (\n              <Modal\n                title={`Move ${document.noun}`}\n                onRequestClose={this.goBack}\n                isOpen\n              >\n                <DocumentMove\n                  document={document}\n                  onRequestClose={this.goBack}\n                />\n              </Modal>\n            )}\n          />\n          <PageTitle\n            title={document.titleWithDefault.replace(document.emoji, \"\")}\n            favicon={document.emoji ? emojiToUrl(document.emoji) : undefined}\n          />\n          {(this.isUploading || this.isSaving) && <LoadingIndicator />}\n\n          <Container justify=\"center\" column auto>\n            {!readOnly && (\n              <>\n                <Prompt\n                  when={this.isDirty && !this.isUploading}\n                  message={t(\n                    `You have unsaved changes.\\nAre you sure you want to discard them?`\n                  )}\n                />\n                <Prompt\n                  when={this.isUploading && !this.isDirty}\n                  message={t(\n                    `Images are still uploading.\\nAre you sure you want to discard them?`\n                  )}\n                />\n              </>\n            )}\n            <Header\n              document={document}\n              shareId={shareId}\n              isRevision={!!revision}\n              isDraft={document.isDraft}\n              isEditing={!readOnly}\n              isSaving={this.isSaving}\n              isPublishing={this.isPublishing}\n              publishingIsDisabled={\n                document.isSaving || this.isPublishing || this.isEmpty\n              }\n              savingIsDisabled={document.isSaving || this.isEmpty}\n              sharedTree={this.props.sharedTree}\n              goBack={this.goBack}\n              onSave={this.onSave}\n              headings={headings}\n            />\n            <MaxWidth\n              archived={document.isArchived}\n              showContents={showContents}\n              column\n              auto\n            >\n              {document.isTemplate && !readOnly && (\n                <Notice muted>\n                  <Trans>\n                    Youre editing a template. Highlight some text and use the{\" \"}\n                    <PlaceholderIcon color=\"currentColor\" /> control to add\n                    placeholders that can be filled out when creating new\n                    documents from this template.\n                  </Trans>\n                </Notice>\n              )}\n              {document.archivedAt && !document.deletedAt && (\n                <Notice muted>\n                  {t(\"Archived by {{userName}}\", {\n                    userName: document.updatedBy.name,\n                  })}{\" \"}\n                  <Time dateTime={document.updatedAt} addSuffix />\n                </Notice>\n              )}\n              {document.deletedAt && (\n                <Notice muted>\n                  <strong>\n                    {t(\"Deleted by {{userName}}\", {\n                      userName: document.updatedBy.name,\n                    })}{\" \"}\n                    <Time dateTime={document.deletedAt || \"\"} addSuffix />\n                  </strong>\n                  {document.permanentlyDeletedAt && (\n                    <>\n                      <br />\n                      {document.template ? (\n                        <Trans>\n                          This template will be permanently deleted in{\" \"}\n                          <Time dateTime={document.permanentlyDeletedAt} />{\" \"}\n                          unless restored.\n                        </Trans>\n                      ) : (\n                        <Trans>\n                          This document will be permanently deleted in{\" \"}\n                          <Time dateTime={document.permanentlyDeletedAt} />{\" \"}\n                          unless restored.\n                        </Trans>\n                      )}\n                    </>\n                  )}\n                </Notice>\n              )}\n              <React.Suspense fallback={<PlaceholderDocument />}>\n                <Flex auto={!readOnly}>\n                  {showContents && <Contents headings={headings} />}\n                  <Editor\n                    id={document.id}\n                    innerRef={this.editor}\n                    shareId={shareId}\n                    isDraft={document.isDraft}\n                    template={document.isTemplate}\n                    key={[injectTemplate, disableEmbeds].join(\"-\")}\n                    title={revision ? revision.title : this.title}\n                    document={document}\n                    value={readOnly ? value : undefined}\n                    defaultValue={value}\n                    disableEmbeds={disableEmbeds}\n                    onImageUploadStart={this.onImageUploadStart}\n                    onImageUploadStop={this.onImageUploadStop}\n                    onSearchLink={this.props.onSearchLink}\n                    onCreateLink={this.props.onCreateLink}\n                    onChangeTitle={this.onChangeTitle}\n                    onChange={this.onChange}\n                    onSave={this.onSave}\n                    onPublish={this.onPublish}\n                    onCancel={this.goBack}\n                    readOnly={readOnly}\n                    readOnlyWriteCheckboxes={readOnly && abilities.update}\n                    ui={this.props.ui}\n                  >\n                    {shareId && (\n                      <ReferencesWrapper isOnlyTitle={document.isOnlyTitle}>\n                        <PublicReferences\n                          shareId={shareId}\n                          documentId={document.id}\n                          sharedTree={this.props.sharedTree}\n                        />\n                      </ReferencesWrapper>\n                    )}\n                    {!isShare && !revision && (\n                      <>\n                        <MarkAsViewed document={document} />\n                        <ReferencesWrapper isOnlyTitle={document.isOnlyTitle}>\n                          <References document={document} />\n                        </ReferencesWrapper>\n                      </>\n                    )}\n                  </Editor>\n                </Flex>\n              </React.Suspense>\n            </MaxWidth>\n          </Container>\n        </Background>\n        {isShare && !isCustomDomain() && (\n          <Branding href=\"//www.getoutline.com?ref=sharelink\" />\n        )}\n        {!isShare && <KeyboardShortcutsButton />}\n      </ErrorBoundary>\n    );\n  }\n}\n\nconst PlaceholderIcon = styled(InputIcon)`\n  position: relative;\n  top: 6px;\n`;\n\nconst Background = styled(Container)`\n  background: ${(props) => props.theme.background};\n  transition: ${(props) => props.theme.backgroundTransition};\n`;\n\nconst ReferencesWrapper = styled(\"div\")`\n  margin-top: ${(props) => (props.isOnlyTitle ? -45 : 16)}px;\n\n  @media print {\n    display: none;\n  }\n`;\n\nconst MaxWidth = styled(Flex)`\n  ${(props) =>\n    props.archived && `* { color: ${props.theme.textSecondary} !important; } `};\n  padding: 0 12px;\n  max-width: 100vw;\n  width: 100%;\n\n  ${breakpoint(\"tablet\")`\t\n    padding: 0 24px;\n    margin: 4px auto 12px;\n    max-width: calc(48px + ${(props) =>\n      props.showContents ? \"64em\" : \"46em\"});\n  `};\n\n  ${breakpoint(\"desktopLarge\")`\n    max-width: calc(48px + 52em);\n  `};\n`;\n\nexport default withRouter(\n  withTranslation()<DocumentScene>(\n    inject(\"ui\", \"auth\", \"toasts\")(DocumentScene)\n  )\n);\n","// @flow\n\nexport function emojiToUrl(text: string) {\n  return `data:image/svg+xml;data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>${text}</text></svg>`;\n}\n","// @flow\nimport * as React from \"react\";\nimport UiStore from \"stores/UiStore\";\n\ntype Props = {\n  ui: UiStore,\n  children?: React.Node,\n};\n\nclass HideSidebar extends React.Component<Props> {\n  componentDidMount() {\n    this.props.ui.enableEditMode();\n  }\n\n  componentWillUnmount() {\n    this.props.ui.disableEditMode();\n  }\n\n  render() {\n    return this.props.children || null;\n  }\n}\n\nexport default HideSidebar;\n","// @flow\nimport * as React from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport CenteredContent from \"components/CenteredContent\";\nimport PageTitle from \"components/PageTitle\";\nimport PlaceholderDocument from \"components/PlaceholderDocument\";\nimport Container from \"./Container\";\nimport type { LocationWithState } from \"types\";\n\ntype Props = {|\n  location: LocationWithState,\n|};\n\nexport default function Loading({ location }: Props) {\n  const { t } = useTranslation();\n\n  return (\n    <Container column auto>\n      <PageTitle\n        title={location.state ? location.state.title : t(\"Untitled\")}\n      />\n      <CenteredContent>\n        <PlaceholderDocument />\n      </CenteredContent>\n    </Container>\n  );\n}\n","// @flow\nimport * as React from \"react\";\nimport { USER_PRESENCE_INTERVAL } from \"shared/constants\";\nimport { SocketContext } from \"components/SocketProvider\";\n\ntype Props = {\n  children?: React.Node,\n  documentId: string,\n  isEditing: boolean,\n};\n\nexport default class SocketPresence extends React.Component<Props> {\n  static contextType = SocketContext;\n  previousContext: any;\n  editingInterval: IntervalID;\n\n  componentDidMount() {\n    this.editingInterval = setInterval(() => {\n      if (this.props.isEditing) {\n        this.emitPresence();\n      }\n    }, USER_PRESENCE_INTERVAL);\n    this.setupOnce();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    this.setupOnce();\n\n    if (prevProps.isEditing !== this.props.isEditing) {\n      this.emitPresence();\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.context) {\n      this.context.emit(\"leave\", { documentId: this.props.documentId });\n      this.context.off(\"authenticated\", this.emitJoin);\n    }\n\n    clearInterval(this.editingInterval);\n  }\n\n  setupOnce = () => {\n    if (this.context && this.context !== this.previousContext) {\n      this.previousContext = this.context;\n\n      if (this.context.authenticated) {\n        this.emitJoin();\n      }\n      this.context.on(\"authenticated\", () => {\n        this.emitJoin();\n      });\n    }\n  };\n\n  emitJoin = () => {\n    if (!this.context) return;\n\n    this.context.emit(\"join\", {\n      documentId: this.props.documentId,\n      isEditing: this.props.isEditing,\n    });\n  };\n\n  emitPresence = () => {\n    if (!this.context) return;\n\n    this.context.emit(\"presence\", {\n      documentId: this.props.documentId,\n      isEditing: this.props.isEditing,\n    });\n  };\n\n  render() {\n    return this.props.children || null;\n  }\n}\n","// @flow\nimport { formatDistanceToNow } from \"date-fns\";\nimport invariant from \"invariant\";\nimport { deburr, sortBy } from \"lodash\";\nimport { observable } from \"mobx\";\nimport { observer, inject } from \"mobx-react\";\nimport * as React from \"react\";\nimport type { RouterHistory, Match } from \"react-router-dom\";\nimport { withRouter } from \"react-router-dom\";\nimport parseDocumentSlug from \"shared/utils/parseDocumentSlug\";\nimport AuthStore from \"stores/AuthStore\";\nimport DocumentsStore from \"stores/DocumentsStore\";\nimport PoliciesStore from \"stores/PoliciesStore\";\nimport RevisionsStore from \"stores/RevisionsStore\";\nimport SharesStore from \"stores/SharesStore\";\nimport UiStore from \"stores/UiStore\";\nimport Document from \"models/Document\";\nimport Revision from \"models/Revision\";\nimport Error404 from \"scenes/Error404\";\nimport ErrorOffline from \"scenes/ErrorOffline\";\nimport DocumentComponent from \"./Document\";\nimport HideSidebar from \"./HideSidebar\";\nimport Loading from \"./Loading\";\nimport SocketPresence from \"./SocketPresence\";\nimport { type LocationWithState, type NavigationNode } from \"types\";\nimport { NotFoundError, OfflineError } from \"utils/errors\";\nimport { matchDocumentEdit, updateDocumentUrl } from \"utils/routeHelpers\";\nimport { isInternalUrl } from \"utils/urls\";\ntype Props = {|\n  match: Match,\n  location: LocationWithState,\n  shares: SharesStore,\n  documents: DocumentsStore,\n  policies: PoliciesStore,\n  revisions: RevisionsStore,\n  auth: AuthStore,\n  ui: UiStore,\n  history: RouterHistory,\n|};\n\nconst sharedTreeCache = {};\n\n@observer\nclass DataLoader extends React.Component<Props> {\n  sharedTree: ?NavigationNode;\n  @observable document: ?Document;\n  @observable revision: ?Revision;\n  @observable error: ?Error;\n\n  componentDidMount() {\n    const { documents, match } = this.props;\n    this.document = documents.getByUrl(match.params.documentSlug);\n    this.sharedTree = this.document\n      ? sharedTreeCache[this.document.id]\n      : undefined;\n    this.loadDocument();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    // If we have the document in the store, but not it's policy then we need to\n    // reload from the server otherwise the UI will not know which authorizations\n    // the user has\n    if (this.document) {\n      const document = this.document;\n      const policy = this.props.policies.get(document.id);\n\n      if (\n        !policy &&\n        !this.error &&\n        this.props.auth.user &&\n        this.props.auth.user.id\n      ) {\n        this.loadDocument();\n      }\n    }\n\n    // Also need to load the revision if it changes\n    const { revisionId } = this.props.match.params;\n    if (\n      prevProps.match.params.revisionId !== revisionId &&\n      revisionId &&\n      revisionId !== \"latest\"\n    ) {\n      this.loadRevision();\n    }\n  }\n\n  get isEditing() {\n    return this.props.match.path === matchDocumentEdit;\n  }\n\n  onSearchLink = async (term: string) => {\n    if (isInternalUrl(term)) {\n      // search for exact internal document\n      const slug = parseDocumentSlug(term);\n      try {\n        const {\n          document,\n        }: { document: Document } = await this.props.documents.fetch(slug);\n\n        const time = formatDistanceToNow(Date.parse(document.updatedAt), {\n          addSuffix: true,\n        });\n        return [\n          {\n            title: document.title,\n            subtitle: `Updated ${time}`,\n            url: document.url,\n          },\n        ];\n      } catch (error) {\n        // NotFoundError could not find document for slug\n        if (!(error instanceof NotFoundError)) {\n          throw error;\n        }\n      }\n    }\n\n    // default search for anything that doesn't look like a URL\n    const results = await this.props.documents.searchTitles(term);\n\n    return sortBy(\n      results.map((document) => {\n        const time = formatDistanceToNow(Date.parse(document.updatedAt), {\n          addSuffix: true,\n        });\n        return {\n          title: document.title,\n          subtitle: `Updated ${time}`,\n          url: document.url,\n        };\n      }),\n      (document) =>\n        deburr(document.title)\n          .toLowerCase()\n          .startsWith(deburr(term).toLowerCase())\n          ? -1\n          : 1\n    );\n  };\n\n  onCreateLink = async (title: string) => {\n    const document = this.document;\n    invariant(document, \"document must be loaded to create link\");\n\n    const newDocument = await this.props.documents.create({\n      collectionId: document.collectionId,\n      parentDocumentId: document.parentDocumentId,\n      title,\n      text: \"\",\n    });\n\n    return newDocument.url;\n  };\n\n  loadRevision = async () => {\n    const { revisionId } = this.props.match.params;\n    this.revision = await this.props.revisions.fetch(revisionId);\n  };\n\n  loadDocument = async () => {\n    const { shareId, documentSlug, revisionId } = this.props.match.params;\n\n    // sets the document as active in the sidebar if we already have it loaded\n    if (this.document) {\n      this.props.ui.setActiveDocument(this.document);\n    }\n\n    try {\n      const response = await this.props.documents.fetch(documentSlug, {\n        shareId,\n      });\n\n      this.sharedTree = response.sharedTree;\n      this.document = response.document;\n      sharedTreeCache[this.document.id] = response.sharedTree;\n\n      if (revisionId && revisionId !== \"latest\") {\n        await this.loadRevision();\n      } else {\n        this.revision = undefined;\n      }\n    } catch (err) {\n      this.error = err;\n      return;\n    }\n\n    const document = this.document;\n\n    if (document) {\n      const can = this.props.policies.abilities(document.id);\n\n      // sets the document as active in the sidebar, ideally in the future this\n      // will be route driven.\n      this.props.ui.setActiveDocument(document);\n\n      // If we're attempting to update an archived, deleted, or otherwise\n      // uneditable document then forward to the canonical read url.\n      if (!can.update && this.isEditing) {\n        this.props.history.push(document.url);\n        return;\n      }\n\n      // Prevents unauthorized request to load share information for the document\n      // when viewing a public share link\n      if (can.read) {\n        this.props.shares.fetch(document.id).catch((err) => {\n          if (!(err instanceof NotFoundError)) {\n            throw err;\n          }\n        });\n      }\n\n      const isMove = this.props.location.pathname.match(/move$/);\n      const canRedirect = !revisionId && !isMove && !shareId;\n      if (canRedirect) {\n        const canonicalUrl = updateDocumentUrl(this.props.match.url, document);\n        if (this.props.location.pathname !== canonicalUrl) {\n          this.props.history.replace(canonicalUrl);\n        }\n      }\n    }\n  };\n\n  render() {\n    const { location, policies, ui } = this.props;\n\n    if (this.error) {\n      return this.error instanceof OfflineError ? (\n        <ErrorOffline />\n      ) : (\n        <Error404 />\n      );\n    }\n\n    const document = this.document;\n    const revision = this.revision;\n\n    if (!document) {\n      return (\n        <>\n          <Loading location={location} />\n          {this.isEditing && <HideSidebar ui={ui} />}\n        </>\n      );\n    }\n\n    const abilities = policies.abilities(document.id);\n\n    return (\n      <SocketPresence documentId={document.id} isEditing={this.isEditing}>\n        {this.isEditing && <HideSidebar ui={ui} />}\n        <DocumentComponent\n          document={document}\n          revision={revision}\n          abilities={abilities}\n          location={location}\n          readOnly={!this.isEditing || !abilities.update || document.isArchived}\n          onSearchLink={this.onSearchLink}\n          onCreateLink={this.onCreateLink}\n          sharedTree={this.sharedTree}\n        />\n      </SocketPresence>\n    );\n  }\n}\n\nexport default withRouter(\n  inject(\n    \"ui\",\n    \"auth\",\n    \"documents\",\n    \"revisions\",\n    \"policies\",\n    \"shares\"\n  )(DataLoader)\n);\n","// @flow\nimport { inject } from \"mobx-react\";\nimport * as React from \"react\";\nimport DataLoader from \"./components/DataLoader\";\n\nclass KeyedDocument extends React.Component<*> {\n  componentWillUnmount() {\n    this.props.ui.clearActiveDocument();\n  }\n\n  render() {\n    const { documentSlug, revisionId } = this.props.match.params;\n\n    // the urlId portion of the url does not include the slugified title\n    // we only want to force a re-mount of the document component when the\n    // document changes, not when the title does so only this portion is used\n    // for the key.\n    const urlParts = documentSlug ? documentSlug.split(\"-\") : [];\n    const urlId = urlParts.length ? urlParts[urlParts.length - 1] : undefined;\n\n    return <DataLoader key={[urlId, revisionId].join(\"/\")} {...this.props} />;\n  }\n}\n\nexport default inject(\"ui\")(KeyedDocument);\n"],"sourceRoot":""}